<html lang="ru" xml:lang="ru"><head>
<META http-equiv="Content-Type" content="text/html">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><META name="description" content="Для устранения отдельных отказов на уровне
ArcGIS Server, сайт ArcGIS Server на одном компьютере можно сделать отказоустойчивым с помощью стороннего балансировщика нагрузки."><meta name="content-language" content="ru"><link href="rsrc/htmlhelp.css" rel="stylesheet" type="text/css"><title>ArcGIS - 
Развертывание конфигурации с одним активным сервером высокой доступности (active-passive)</title>
                <script type="text/javascript" language="JavaScript">
                    var pathL  = self.location.pathname.split ("/");
                    var fname = pathL[pathL.length-1];
                    var i = fname.lastIndexOf (".htm");
                    if (i>=0) {
                    fname = fname.substring (0, i)
                    } else {
                    //??
                    }
                    if (self.location.hash) {
				    		      fname = fname + self.location.hash;
						        }
                    self.location.replace ("../index.html#//" + fname);
                </script>
                </head><!--Publication GUID: [GUID-FB5257BE-DC53-48C6-82F8-1DA075B0A617]--><!--Topic GUID: [GUID-5BAC2F6A-272F-46A1-B7C1-2051320339BA]--><body><div id="content"><div class="header"><h1>
Развертывание конфигурации с одним активным сервером высокой доступности (active-passive)</h1><div id="breadcrumb"></div></div>
<p id="GUID-36F9A1B2-A480-4256-8D70-EDA6F9381933"> Для устранения отдельных отказов на уровне
<span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span>, сайт <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> на одном компьютере можно сделать отказоустойчивым с помощью стороннего балансировщика нагрузки.</p><p id="GUID-530A2A53-6D12-423C-A75F-A29D9D8EB644"> На самом высоком уровне идея подобного развертывания – клонирование сайта с одним компьютером и размещение как минимум двух его экземпляров за балансировщиком нагрузки с настройкой active-passive. Пока все сайты за балансировщиком нагрузки работают и готовы к запросам сервисов, балансировщик нагрузки будет только передавать запросы на один из сайтов, назначенный в качестве основного. Если балансировщик нагрузки определит, что основной сайт недоступен, входящие запросы будут перенаправлены на резервный.</p><div class="image" purpose="image"><table><tr><td><img class="break" src="01n1/GUID-5C90B73D-37F7-49B6-BA71-C78FE2A76D5D-web.png" purpose="img" alt="Конфигурация развертывания высокой доступности с одним сервером" title="Конфигурация развертывания высокой доступности с одним сервером"></td></tr><tr><td><div class="caption" purpose="caption">Конфигурация развертывания высокой доступности с одним сервером. Администраторы подключаются к каждому сайту отдельно. Сайты имеют одинаковые копии директорий сервера и хранилища конфигураций.</div></td></tr></table></div><p id="GUID-B2F53AB0-20AB-4A1A-87B9-2DE1B681002F"> Отказоустойчивость процесса обеспечивается вне <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span>. И, как правило, резервный сервер настроен на вызов в момент, когда компьютер <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> полностью недоступен (из-за сетевой ошибки или ошибки на уровне аппаратного обеспечения) или для случаев, когда недоступен определенный ГИС-сервис, или какая-то операция не может быть выполнена.</p><div class="notes" id="GUID-4AB84509-E900-4BAA-BF8A-1795C5996A5F"><div class="note"><img class="note_img" src="rsrc/note.png" alt="Примечание" title="Примечание"><span>Примечание:</span></div><div class="tipbody"><p id="GUID-E7204827-F79D-4C0A-BCB5-465EBCEC4760">Вы можете бесплатно запросить файлы лицензии на <span purpose="ph" varid="myesrilink"><a target="_blank" class="xref" href="https://my.esri.com/" rel="https://my.esri.com/">My Esri</a></span> для резервных сайтов</p></div></div><p id="GUID-582734D0-2474-450E-BA4C-513D2701FE6B"> Поскольку несколько компьютеров используются для размещения нескольких <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> в развертывании, такая конфигурация не может быть технически описана как сайт, состоящий из нескольких компьютеров, поскольку каждый сайт за балансировщиком нагрузки независим от другого. Каждый сайт состоит из одного компьютера <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> и имеет собственные локальное хранилище конфигурации и директории сервера.</p>
<div class="section1" id="ESRI_SECTION1_6855783BE1014AAF8C9BAAA490966934" purpose="section1"><h2>Компьютер <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span>, директории сервера и хранилище конфигураций</h2><p id="GUID-14FA6DC6-BCD6-4225-ABE4-05DAC4AE0791"> Используйте те же соображения, которые изложены в разделе <a class="xref" rel="01n1/01n10000002w000000.htm" href="01n1/01n10000002w000000.htm">развертывание с одним компьютером</a>. Каждый
<span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> будет иметь собственные локальные директории сервера и хранилище конфигураций. Это приведет к максимальной производительности и сведет к минимуму взаимозависимости.</p></div><div class="section1" id="ESRI_SECTION1_BF1EDC0004BA41DC802401E547D314D9" purpose="section1"><h2>Данные</h2><p id="GUID-7FF07C0D-DB56-421E-AEF9-68C62417A2CA"> При использовании для ГИС-сервисов файловых источников данных рекомендуется, чтобы они хранились локально на каждом компьютере
<span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span>, а не в общей сетевой папке, поскольку это позволит увеличить производительность сервисов. В некоторых случаях, например, при обработке большого числа изображений, обращение к файлам по сети может оказаться единственным правильным вариантом. При использовании общих сетевых ресурсов вам важно выбрать высокопроизводительное запоминающее устройство.</p><p id="GUID-FC892FD0-09B5-4A0E-AA48-03C3FF722C81">При работе с базами данных вы можете использовать базу данных для каждого сайта: одну для основного сайта и вторую – для резервного. Для поддержки синхронизации баз данных вы можете осуществить репликацию базы данных или, при необходимости, репликацию базы геоданных. Либо использовать высокодоступные техники вашего провайдера базы данных.</p></div><div class="section1" id="ESRI_SECTION1_E28679F50AC74EA885D013361DC0F1E5" purpose="section1"><h2>Обратный прокси-сервер</h2><p id="GUID-9605B5A1-A4C5-4E7B-80F0-F58070FF4D82"> В этой конфигурации требуется сторонний балансировщик нагрузки. Как минимум, этот компонент будет использоваться для распределения нагрузки по всем сайтам и, по необходимости, отказоустойчивости. Обычно балансировщик нагрузки выполняет роль обратного прокси-сервера, как это описано в разделе <a class="xref" rel="01n1/01n10000002r000000.htm" href="01n1/01n10000002r000000.htm">Развертывание на одном компьютере с обратным прокси-сервере</a>. В некоторых случаях у вас уже может быть настроенный <a class="xref" target="_blank" rel="http://server.arcgis.com/ru/server/latest/administer/windows/using-a-reverse-proxy-server-with-arcgis-server.htm" href="http://server.arcgis.com/ru/server/latest/administer/windows/using-a-reverse-proxy-server-with-arcgis-server.htm">обратный прокси-сервер</a> – независимо от загрузчика данных.</p><p id="GUID-C09E8E7A-2E5A-4CA2-9C60-6AA77BD53977">Если вы используете балансировщики загрузки с функцией проверки работоспособности, рекомендуем вам использовать точку доступа проверки работоспособности <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span>, чтобы определить, сможет ли сайт получать запросы.  Это используется, чтобы быстро определить, нет ли на сайте аппаратного или программного сбоя.  Дополнительные сведения см. в разделе <a class="xref" target="_blank" rel="http://resources.arcgis.com/ru/help/arcgis-rest-api/02r3/02r3000002n7000000.htm" href="http://resources.arcgis.com/ru/help/arcgis-rest-api/02r3/02r3000002n7000000.htm">Проверка работоспособности</a> в ArcGIS REST API.</p><p id="GUID-4F6CC4E8-8356-43C3-B384-011F5711C6D7"> Использование ArcGIS Web Adaptor не является обязательным и обычно требуется, только если вы хотите получить преимущество аутентификации веб-уровня. Для простоты можно настроить его на том же компьютере, что и <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span>.  Либо же на отдельном компьютере. В любом случае, при работе с ArcGIS Web Adaptor необходимо настроить отдельный ArcGIS Web Adaptor для каждого сайта.</p></div><div class="section1" id="ESRI_SECTION1_196562782F0149D9A8D7862BA38841EB" purpose="section1"><h2>Другие соображения</h2><div class="section2" id="ESRI_SECTION2_C0955A61BFD348F68136E7289F25B83B" purpose="section2"><h3>Поддержка синхронности сервисов сайтов</h3><p id="GUID-236BE866-44C2-4547-A913-EFAC3C3B4888"> В отличие от сайта с несколькими компьютерами, эта настройка требует, чтобы все сайты под балансировщиком нагрузки имели одинаковые ресурсы и модель безопасности. Вы должны убедиться, что все сайты выглядят одинаково.</p><p id="GUID-8F3DE45D-6ADC-4E02-9070-DB09850AFCC8"> Есть несколько способов синхронизации сервисов <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> через основной и резервные сайты:</p><ul purpose="ul" id="UL_F4A876F72DBB46A397A69054C851CD96"><li purpose="li" id="LI_2402FD84A05D4D2695366E4E4B018FF4">Написание скриптов: <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> включает административный REST API, который может использоваться для написания скриптов с административными задачами, такими как публикация сервисов и изменение настроек их безопасности. Вы можете написать собственные скрипты, чтобы внести изменения во все участвующие в развертывании серверы <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span>. Написание скриптов особенно полезно в случае необходимости внесения небольших улучшений, к примеру, изменения безопасности сервиса или его перезаписывание. Подробнее см. в разделе <a class="xref" target="_blank" rel="http://server.arcgis.com/ru/server/latest/administer/windows/scripting-arcgis-server-administration.htm" href="http://server.arcgis.com/ru/server/latest/administer/windows/scripting-arcgis-server-administration.htm">Написание скриптов администрирования ArcGIS Server</a>.</li><li purpose="li" id="LI_952B7B2D50774CF58097DC68DC7094F5"> Виртуализация: Если вы работаете в виртуальной среде, можно создать и использовать для запуска новых сайтов шаблоны виртуальных компьютеров. Каждый шаблон будет иметь копию данных для ГИС-сервисов (если не используется база данных). Шаблон будет также содержать опубликованные и настроенные сервисы. Если необходимы изменения, например, добавление или обновление имеющихся сервисов, можно создать новый шаблон для последующего запуска новых виртуальных машин, которые заменят имеющийся пул компьютеров <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> под балансировщиком нагрузки. Шаблоны виртуальных машин могут также использоваться для быстрого восстановления устаревших компьютеров <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span>.</li></ul><p id="GUID-34948C59-10A8-43D3-9F4B-0BA0299F63D9"> Рекомендуемая процедура применения изменений к сайтам:</p><div class="wfsteps" purpose="wfsteps"><h4></h4><div class="steps" id="ESRI_STEPS_784E84BE74D5437E9707B1399BAF19EE"><div class="step_title">Шаги:</div><ol><li purpose="step" id="ESRI_STEP_B00B728FB6064C4E9681C58120712FBB"><span purpose="cmd" id="GUID-212C7A42-1687-4CCF-8C9C-07B0C4F1FB24"> Административные изменения будут вначале применены к сайту, находящемуся в режиме ожидания. Например, вы можете добавить новый сервис и изменить безопасность другого сервиса на сайте, не обрабатывающем запросы. Это гарантирует, что не будет никакого влияния на приложения, при использовании вашего основного сайта.</span></li><li purpose="step" id="ESRI_STEP_4EB66725C203433EAE03FF73D698F6EA"><span purpose="cmd" id="GUID-437B3239-C47C-4C38-B0B1-FCDD44E91446">Настройте вручную свой балансировщик нагрузки для обработки всех запросов резервным сайтом, для которого были выполнены изменения.</span></li><li purpose="step" id="ESRI_STEP_4D19A677A2694061AFDF1806C895BB3B"><span purpose="cmd" id="GUID-6350C413-0F06-4D6C-AE2D-8AE3C45F3423">Внесите те же изменения в основной сайт.</span></li><li purpose="step" id="ESRI_STEP_18542AF42544419FA949DC39C30CDBD4"><span purpose="cmd" id="GUID-43995EA3-BF8D-431F-9636-94A578E0E428">Настройте балансировщик нагрузки так, чтобы запросы направлялись опять на основной сайт и оставьте резервный сайт в режиме ожидания.</span></li></ol></div></div><p id="GUID-87CCE021-1815-4423-8A82-75FB64408A6B"> Изменения в вашем сайте в описанной выше процедуре можно применить вручную с помощью <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> Manager, скриптов и виртуальных образов.</p></div><div class="section2" id="ESRI_SECTION2_7A70BE1D4E11428099693C68837E9A51" purpose="section2"><h3>Асинхронная геообработка и длительные задачи</h3><p id="GUID-63ABF49E-433F-4944-AAC1-5820842EE1EF"> Когда балансировщик нагрузки переключается на резервный сайт, все активные запросы основного сайта теряются. Например, если такой длительный запрос, как задача геообработки, работает в отказоустойчивом режиме, задача должна быть заново инициализирована на резервном сайте клиентским приложением.</p></div><div class="section2" id="ESRI_SECTION2_AD2A918F0F5D4FF59EEDA3502C56B77A" purpose="section2"><h3>Использование безопасности на уровне токенов</h3><p id="GUID-D8F944FD-F648-4A63-84EB-013DDE5EE2F1"> При использовании аутентификации на уровне токенов, которую также называют аутентификацией на уровне ГИС, важно, чтобы все сайты конфигурации использовали один и тот же ключ токена. В противном случае созданные на основном сайте токены будут некорректны при работе с резервным сайтом. Чтобы узнать о дублировании общих ключей токенов для нескольких сайтов, обратитесь к разделам <a class="xref" target="_blank" rel="http://server.arcgis.com/ru/server/latest/administer/windows/about-arcgis-tokens.htm" href="http://server.arcgis.com/ru/server/latest/administer/windows/about-arcgis-tokens.htm">О токенах ArcGIS</a> и <a class="xref" target="_blank" rel="http://server.arcgis.com/ru/server/latest/administer/windows/editing-token-settings-in-manager.htm" href="http://server.arcgis.com/ru/server/latest/administer/windows/editing-token-settings-in-manager.htm">Редактирование настроек токенов в Manager</a>.</p></div></div><div class="section1" id="ESRI_SECTION1_BF8390AFC33E4EE28CC8EFEA035E1177" purpose="section1"><h2>Достоинства</h2><ul purpose="ul" id="UL_D574A80631724B608ABA0C3675CC3E59"><li purpose="li" id="LI_B0AE7ABEB5DE479E8502D99B03B1A1AB">Отказоустойчивая конфигурация active-passive позволит вам построить отказоустойчивую уровень <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> без необходимости дополнительно оплачивать лицензию. Резервные серверы можно лицензировать бесплатно.</li></ul></div><div class="section1" id="ESRI_SECTION1_9A6F1AE806F140AD80FB926FCF4A55CA" purpose="section1"><h2>Недостатки</h2><ul purpose="ul" id="UL_2C134694CD7344C2B3B6E70AD1BDB471"><li purpose="li" id="LI_B00353D7F391425ABB1010D183B89649">Каждый сайт за балансировщиком нагрузки независим от других. Каждый сайт управляется отдельно. Сайты имеют общие локальное хранилище конфигурации и директории сервера. Это потенциально увеличивает сложность администрирования, в случае, если сервисы сайта или данные будут часто обновляться.</li><li purpose="li" id="LI_F90D1CC466E14AA49D912E0C125EC2AC">При переключении на резервный сайт теряются все активные запросы основного сайта.</li></ul></div><div class="footer"> Copyright © 1995-2017 Esri. All rights reserved. </div></div></body></html>