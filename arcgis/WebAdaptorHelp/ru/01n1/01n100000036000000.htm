<html lang="ru" xml:lang="ru"><head>
<META http-equiv="Content-Type" content="text/html">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><META name="description" content="Обратный прокси-сервер – это компьютер, установленный в пределах пограничной сети (так называемой демилитаризованной зоны [DMZ] или промежуточной подсети), который обрабатывает запросы из Интернета и перенаправляет их на компьютеры внутренней сети."><meta name="content-language" content="ru"><link href="rsrc/htmlhelp.css" rel="stylesheet" type="text/css"><title>ArcGIS - 
Использование обратного прокси-сервера с Portal for ArcGIS</title>
                <script type="text/javascript" language="JavaScript">
                    var pathL  = self.location.pathname.split ("/");
                    var fname = pathL[pathL.length-1];
                    var i = fname.lastIndexOf (".htm");
                    if (i>=0) {
                    fname = fname.substring (0, i)
                    } else {
                    //??
                    }
                    if (self.location.hash) {
				    		      fname = fname + self.location.hash;
						        }
                    self.location.replace ("../index.html#//" + fname);
                </script>
                </head><!--Publication GUID: [GUID-FB5257BE-DC53-48C6-82F8-1DA075B0A617]--><!--Topic GUID: [GUID-E452FD74-CAA7-4871-BC78-990DC4D01E03]--><body><div id="content"><div class="header"><h1>
Использование обратного прокси-сервера с Portal for ArcGIS</h1><div id="breadcrumb"></div></div>
<p id="GUID-E6059846-9BAC-4204-8CA5-AA40D26CE425">Обратный прокси-сервер – это компьютер, установленный в пределах пограничной сети (так называемой демилитаризованной зоны [DMZ] или промежуточной подсети), который обрабатывает запросы из Интернета и перенаправляет их на компьютеры внутренней сети. Перенаправление запросов от имени обратного прокси-сервера маскирует идентичность компьютеров за брандмауэром организации, что позволяет защитить внутренние компьютеры от атак из Интернета. На обратном прокси-сервере можно реализовать дополнительные функции безопасности, позволяющие еще больше защитить внутреннюю сеть от пользователей извне.</p><p id="GUID-1275121D-C786-4A30-98F5-8F46E77A2F67"> Если вы используете обратный прокси-сервер с функцией проверки работоспособности, рекомендуем вам использовать точку доступа проверки работоспособности <span purpose="ph" translate="no" varid="PortalForArcGIS">Portal for ArcGIS</span>, чтобы определить, может ли портал получать запросы. Это используется, чтобы быстро определить, нет ли на сайте аппаратного или программного сбоя. Дополнительные сведения см. в разделе <a class="xref" target="_blank" rel="http://resources.arcgis.com/ru/help/arcgis-rest-api/02r3/02r300000306000000.htm" href="http://resources.arcgis.com/ru/help/arcgis-rest-api/02r3/02r300000306000000.htm">Проверка работоспособности</a> в ArcGIS REST API.</p>
<div class="notes" id="GUID-B752AE0F-289C-4AD2-829B-7A439E7D7FCD"><div class="caution"><img class="note_img" src="rsrc/caution.png" alt="Внимание" title="Внимание"><span>Внимание:</span></div><div class="tipbody"><p id="GUID-FB823391-E68A-4647-9728-6449BCA394C1"> специфические настройки, описанные в этом разделе, должны быть применены перед интеграцией любого сайта <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> с вашим порталом <span purpose="ph" translate="no" varid="ArcGIS_Enterprise_long">ArcGIS Enterprise</span>. Отмена интеграции сайта <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> приведет к ряду существенных изменений, и просто вернуть все обратно будет затруднительно. Для дополнительной информации см. <a class="xref" target="_blank" rel="http://server.arcgis.com/ru/portal/latest/administer/windows/administer-a-federated-server.htm" href="http://server.arcgis.com/ru/portal/latest/administer/windows/administer-a-federated-server.htm">Администрирование интегрированного сервера</a>.</p></div></div><div class="section1" id="ESRI_SECTION1_95330DD599D34B899A6AEF123440D24A" purpose="section1"><h2>Добавление <span purpose="ph" translate="no" varid="PortalForArcGIS">Portal for ArcGIS</span> к обратному прокси-серверу</h2><p id="GUID-57E96981-0F4F-4CCD-8575-3887DFF10792">Перед добавлением <span purpose="ph" translate="no" varid="PortalForArcGIS">Portal for ArcGIS</span> к обратному прокси-серверу организации, необходимо выполнить следующие шаги:</p><ul purpose="ul" id="UL_F5978DE6A82346F08A10E966A8728ACE"><li purpose="li" id="LI_85752451301946C7818E4E5249B90325"> Настройка HTTPS (HTTP и HTTPS или только HTTPS) на обратном прокси-сервере. Для некоторых видов связи <span purpose="ph" translate="no" varid="PortalForArcGIS">Portal for ArcGIS</span> требуется HTTPS. Обратитесь к документации к прокси-серверу, чтобы узнать о настройке HTTPS.</li><li purpose="li" id="LI_F8E6F46E52544930BB282767356DEF21">Настройте <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> для работы с порталом, если ваш портал будет использовать <a class="xref" rel="01n1/01n100000029000000.htm" href="01n1/01n100000029000000.htm">Встроенную аутентификацию Windows</a>. Для этого <span purpose="ph" translate="no" varid="PortalForArcGIS">Portal for ArcGIS</span> необходимо использовать <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span>, это позволит обратному прокси-серверу правильно работать с порталом.  Подробные инструкции см. в разделах по настройке <a class="xref" rel="01n1/01n10000001p000000.htm" href="01n1/01n10000001p000000.htm">IIS</a>, <a class="xref" target="_blank" rel="http://server.arcgis.com/ru/portal/latest/administer/windows/configure-arcgis-web-adaptor-portal.htm" href="http://server.arcgis.com/ru/portal/latest/administer/windows/configure-arcgis-web-adaptor-portal.htm">Java (Windows)</a> или <a class="xref" target="_blank" rel="http://server.arcgis.com/ru/portal/latest/administer/windows/configure-arcgis-web-adaptor-portal.htm" href="http://server.arcgis.com/ru/portal/latest/administer/windows/configure-arcgis-web-adaptor-portal.htm">Java (Linux)</a>.</li></ul><p id="GUID-37C824CC-8344-4847-B87E-A773A4917343"> После настройки <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> с <span purpose="ph" translate="no" varid="PortalForArcGIS">Portal for ArcGIS</span>, <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> можно использовать с обратным прокси-сервером вашей организации, добавив эти компоненты непосредственно в директивы прокси. Например, если вы используете Apache в качестве обратного прокси-сервера, вам потребуется добавить <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> в директивы ProxyPass в файл конфигурации веб-сервера Apache <span class="usertext">httpd.conf</span>:</p><div class="codeblock" purpose="codeblock"><div class="highlight"><pre><code>ProxyPass /arcgis https://webadaptorhost.domain.com/webadaptorname
ProxyPassReverse /arcgis https://webadaptorhost.domain.com/webadaptorname
</code></pre></div>
</div><p id="GUID-FE2EA9BF-35AA-4795-ADD1-53CD686B7D1C">Директивы ProxyPass должны соответствовать имени, назначенному для <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> (<span class="usertext">/webadaptorname</span> в примере выше).  Если URL-адрес сайта не заканчивается используемой по умолчанию строкой <span class="usertext">/arcgis</span>, введите используемое имя <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> (например, <span class="usertext">/myorg</span>).</p><p id="GUID-9F7B9781-DE8C-4648-BA8B-71B50B1AD252">Убедитесь, что прокси-сервер поддерживает сжатие gzip и настроен на поддержку заголовка <span class="usertext">Accept-Encoding</span>. Этот заголовок поддерживает сжатие ответов HTTP 1.1 с помощью gzip. Например, если заголовок разрешен, запрос загрузки в <span purpose="ph" translate="no" varid="AGMapViewer">Map Viewer</span> возвратит в браузер сжатый ответ, имеющий объем, равный 1,4 МБ. Если же заголовок не разрешен или игнорируется, запрос возвратит в браузер несжатый ответ, имеющий объем, равный 6,8 МБ. Если скорость вашей сети невелика, <span purpose="ph" translate="no" varid="AGMapViewer">Map Viewer</span> может долго загружаться, если ответы не сжимаются. Рекомендуем разрешить заголовок в качестве части настройки вашего обратного прокси-сервера.</p><p id="GUID-74EBEF4A-6086-41E1-B684-E34751FB0F74">Задайте свойство портала <span class="usertext">WebContextURL</span>. Это позволит <span purpose="ph" translate="no" varid="PortalForArcGIS">Portal for ArcGIS</span> построить корректные URL-адреса для всех ресурсов, которые он направляет конечному пользователю. Чтобы изменить <span class="usertext">WebContextURL</span>, сделайте следующее:</p><div class="wfsteps" purpose="wfsteps"><h4></h4><div class="steps" id="GUID-6E6E7C99-8AEA-46C9-8F20-020A8CFAB3DC"><div class="step_title">Шаги:</div><ol>
<li purpose="step" id="GUID-59FDE619-ABBD-4492-BFEE-28FF55DE3383">
<span purpose="cmd" id="GUID-9EA6CB2B-42D5-4CDB-B3F4-A6B7F812091D">Откройте веб-браузер и войдите в <a class="xref" target="_blank" rel="http://server.arcgis.com/ru/portal/latest/administer/windows/about-the-arcgis-portal-directory.htm" href="http://server.arcgis.com/ru/portal/latest/administer/windows/about-the-arcgis-portal-directory.htm">ArcGIS Portal Directory</a> в качестве участника с ролью администратора по умолчанию в вашей организации портала. Адрес URL в формате <span class="usertext">https://portal.domain.com:7443/arcgis/portaladmin</span>.</span>
</li>
<li purpose="step" id="ESRI_STEP_4A71032028594FDFAE77EB6051A96881"><span purpose="cmd" id="GUID-A236D912-6825-4E73-B1DB-D8C814D49586">Щелкните <span class="uicontrol">Система <span class="greaterthan">&gt;</span> Свойства <span class="greaterthan">&gt;</span> Обновить свойства</span>.</span></li><li purpose="step" id="ESRI_STEP_0EF7E5092BE34404ABD96EE79938D1D4"><span purpose="cmd" id="GUID-063C0CE8-7348-4DDA-BB7E-7A4032491D28">В диалоговом окне <span class="uicontrol">Обновить свойства системы</span> вставьте следующий JSON, заменив собственный URL-адрес обратного прокси или псевдоним DNS тем, который видят пользователи за пределами брандмауэра вашей организации.</span><div class="info" purpose="info"><div class="codeblock" purpose="codeblock"><div class="highlight"><pre><code>{
   &quot;WebContextURL&quot;: &quot;https://reverseproxy.domain.com/myorg&quot;
}
</code></pre></div>
</div></div></li><li purpose="step" id="ESRI_STEP_1457CC3BB07B4B71B9EC8B3D90E02C29"><span purpose="cmd" id="GUID-2D3DBC34-4358-4CC3-97A3-A368FAFB412E">Щелкните <span class="uicontrol">Обновить свойства</span>.</span></li></ol></div><div class="result" id="ESRI_RESULT_E0467B285DAC41E8A139B7CE28B5FB8D" purpose="result"><p id="GUID-8C019229-BD7E-4ABB-B2A4-BB6F6254F952">  Теперь, когда настройка обратного прокси сервера с вашим порталом завершена, вы будете входить на свой портал через URL-адрес обратного прокси-сервера, а не по URL-адресу <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span>. Все, что вам будет доступно на веб-сайте портала или в ArcGIS Portal Directory, вы будете получать через URL обратного прокси-сервера.</p><p id="GUID-D24561C2-6370-4C50-A1B0-7BC7114463E1">Следующие административные задачи необходимо повторить, используя URL обратного прокси-сервера:</p><ul purpose="ul" id="UL_41CD7E1BB59F467797051D32633B1739"><li purpose="li" id="LI_3CDA933062E64F718442AF43005DBC63"><a class="xref" target="_blank" rel="http://server.arcgis.com/ru/portal/latest/administer/windows/federate-an-arcgis-server-site-with-your-portal.htm" href="http://server.arcgis.com/ru/portal/latest/administer/windows/federate-an-arcgis-server-site-with-your-portal.htm">Интеграция сайта ArcGIS Server с порталом</a></li><li purpose="li" id="LI_F3E155D55DBD47D1B5F99B32FC125622"><a class="xref" target="_blank" rel="http://server.arcgis.com/ru/portal/latest/administer/windows/configure-services.htm" href="http://server.arcgis.com/ru/portal/latest/administer/windows/configure-services.htm">Настройка служебных сервисов</a></li></ul><p id="GUID-59AEAE25-42E1-41C5-9348-2710B487DCC2">Если ранее вы добавили защищенные сервисы как элементы вашего портала, то исходные элементы необходимо удалить и добавить снова. Это необходимо сделать, потому что исходные элементы используют URL-адрес <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span>, а не URL обратного прокси-сервера.  Инструкции см. в разделе <a class="xref" target="_blank" rel="http://server.arcgis.com/ru/portal/latest/administer/windows/connect-secured-services.htm" href="http://server.arcgis.com/ru/portal/latest/administer/windows/connect-secured-services.htm">Подключение к защищенным сервисам</a>.</p></div></div></div><div class="footer"> Copyright © 1995-2017 Esri. All rights reserved. </div></div></body></html>