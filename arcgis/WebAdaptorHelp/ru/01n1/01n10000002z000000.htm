<html lang="ru" xml:lang="ru"><head>
<META http-equiv="Content-Type" content="text/html">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><META name="description" content="Развертывание active-active – это способ добиться высокой доступности производственной среды путем использования одного отказоустойчивого компьютера ArcGIS Server."><meta name="content-language" content="ru"><link href="rsrc/htmlhelp.css" rel="stylesheet" type="text/css"><title>ArcGIS - Конфигурация развертывания с одним сервером высокой доступности (active-active)</title>
                <script type="text/javascript" language="JavaScript">
                    var pathL  = self.location.pathname.split ("/");
                    var fname = pathL[pathL.length-1];
                    var i = fname.lastIndexOf (".htm");
                    if (i>=0) {
                    fname = fname.substring (0, i)
                    } else {
                    //??
                    }
                    if (self.location.hash) {
				    		      fname = fname + self.location.hash;
						        }
                    self.location.replace ("../index.html#//" + fname);
                </script>
                </head><!--Publication GUID: [GUID-FB5257BE-DC53-48C6-82F8-1DA075B0A617]--><!--Topic GUID: [GUID-D05F2CE7-BB97-4B83-888E-8750E42C8234]--><body><div id="content"><div class="header"><h1>Конфигурация развертывания с одним сервером высокой доступности (active-active)</h1><div id="breadcrumb"></div></div>
<p id="GUID-D10C0CE4-3E31-4EB5-9CF1-BB8000F12735"> Данная конфигурация – вариант <a class="xref" rel="01n1/01n10000002s000000.htm" href="01n1/01n10000002s000000.htm">развертывания с одним сервером высокой доступности (active-passive)</a>, при котором балансировка нагрузки всегда настроена на распределение по всем сайтам. В данной конфигурации нет ожидающих сайтов.</p><p id="GUID-05D90C41-2896-4CA2-9E9B-BFB61C97EE67"> Для такой архитектуры за сторонним балансировщиком нагрузки настроены два и более сайта для увеличения вместимости вашего развертывания <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span>. Вы можете воспользоваться этой техникой для установки ограничений, описанных в способах развертывания <a class="xref" rel="01n1/01n10000002w000000.htm" href="01n1/01n10000002w000000.htm">развертывание на одном компьютере</a> и <a class="xref" rel="01n1/01n10000002r000000.htm" href="01n1/01n10000002r000000.htm">развертывание на одном компьютере с обратным прокси-сервером</a> или для масштабирования – добавления дополнительных компьютеров.</p><p id="GUID-58CAD460-A6FE-446A-A387-BB257F9FF7CF"> Хотя вы можете использовать масштабирование и добиться высокой доступности с помощью сайтов с несколькими машинами, есть ряд преимуществ и ограничений развертываний active-active, которые обсуждаются ниже.</p><div class="image" purpose="image"><table><tr><td><img class="break" src="01n1/GUID-90564278-838E-4EBC-9623-219347F4CCCC-web.png" purpose="img" alt="Развертывание active-active с двумя сайтами" title="Развертывание active-active с двумя сайтами"></td></tr><tr><td><div class="caption" purpose="caption">Развертывание active-active с двумя сайтами Администраторы подключаются к каждому сайту отдельно. Сайты имеют одинаковые копии директорий сервера и хранилища конфигураций.</div></td></tr></table></div><p id="GUID-0E95AE0A-1D33-4BA3-8939-8CD03DD6C47A"> На высшем уровне идея архитектуры active-active с одним компьютером – клонирование сайта с одним компьютером и размещение его независимых экземпляров за балансировщиком нагрузки. Технически эта конфигурация не может быть описана как сайт с несколькими компьютерами, поскольку каждый из сайтов независим от другого, состоит из одного компьютера <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> и имеет собственные локальные хранилища конфигурации и директории сервера.</p><p id="GUID-3F39950B-CBC0-4F66-A3C8-C2EA3E97626A">Развертывания сайта <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> с несколькими компьютерами намного упрощают администрирование сервера.   Однако архитектура active-active может использоваться в сценариях, в которых число и свойства сервисов определены, остаются неизменными и обеспечивают значительное увеличение производительности с сайтами на нескольких компьютерах – особенно это относится к кэшированным сервисам.</p>
<div class="section1" id="ESRI_SECTION1_4F3569517C2B468A8E70D2523F654294" purpose="section1"><h2>Компьютеры <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span>, директории сервера и хранилище конфигураций</h2><p id="GUID-DFD8B1CC-4625-4260-88FD-AECD77125A30">Каждый компьютер <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> должен иметь собственное локальное хранилище конфигураций, кэши, задания и системные директории.  Это приведет к максимальной производительности и сведет к минимуму взаимозависимости. С другой стороны, выходная директория (или директории) должна быть доступна с каждого сайта. Более подробно см. ниже раздел <a class="xref" rel="01n1/01n10000002z000000.htm#ESRI_SECTION2_18A9D985BCFE499E9519BC5084CCB1B3" href="01n1/01n10000002z000000.htm#ESRI_SECTION2_18A9D985BCFE499E9519BC5084CCB1B3">Другие рекомендации</a>.</p></div><div class="section1" id="ESRI_SECTION1_D145A38FA7744A09BEF49F7BFFFBB5ED" purpose="section1"><h2>Данные</h2><p id="GUID-3667FA67-0195-4578-BEE3-5D95D4A459BB"> Используйте те же соображения, которые изложены в разделе <a class="xref" rel="01n1/01n10000002s000000.htm" href="01n1/01n10000002s000000.htm">Конфигурация развертывания высокой доступности с одним активным сервером (active-passive)</a>.</p></div><div class="section1" id="ESRI_SECTION1_8EF751A1A0674003B0A8AEE7DD7C0FAC" purpose="section1"><h2>  Обратный прокси-сервер</h2><p id="GUID-08D30EAA-3B15-4022-9815-F24432074696"> В этой конфигурации требуется сторонний балансировщик нагрузки. Как минимум, этот компонент распределяет нагрузку по всем сайтам. Балансировщики нагрузки имеют разные настройки распределения нагрузки, например, круговую и с наименьшим числом подключений. Выбор правильного распределения нагрузки отражается на веб-сервисах, запущенных на сайтах <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> и особенностях их использования.  Балансировщики нагрузки обычно используют различные опции обработки ошибок. К примеру, вы можете применить правила в своем балансировщике нагрузки, которые предотвратят пересылку запросов на компьютер, недоступный из-за ошибки сети или аппаратного обеспечения, или недоступности конкретного сервиса на <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span>. При использовании сайтов с одним компьютером, как показано в этой модели, запросы, посылаемые на конкретный компьютер, обрабатываются именно им.</p><p id="GUID-A0ECF165-A482-4351-963D-45E5266F6145"> Обычно балансировщик загрузки сам выполняет роль обратного прокси-сервера, как это описано в разделе <a class="xref" rel="01n1/01n10000002r000000.htm" href="01n1/01n10000002r000000.htm">Развертывание на одном компьютере с обратным прокси-сервером</a>. В некоторых случаях у вас уже может быть настроенный <a class="xref" target="_blank" rel="http://server.arcgis.com/ru/server/latest/administer/windows/using-a-reverse-proxy-server-with-arcgis-server.htm" href="http://server.arcgis.com/ru/server/latest/administer/windows/using-a-reverse-proxy-server-with-arcgis-server.htm">обратный прокси-сервер</a> – независимо от загрузчика данных.</p><p id="GUID-F79D5977-06ED-4481-B6B3-074FFE7C8F1C">Если вы используете балансировщики загрузки с функцией проверки работоспособности, рекомендуем вам использовать точку доступа проверки работоспособности <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span>, чтобы определить, сможет ли сайт получать запросы.  Это используется, чтобы быстро определить, нет ли на сайте аппаратного или программного сбоя.  Дополнительные сведения см. в разделе <a class="xref" target="_blank" rel="http://resources.arcgis.com/ru/help/arcgis-rest-api/02r3/02r3000002n7000000.htm" href="http://resources.arcgis.com/ru/help/arcgis-rest-api/02r3/02r3000002n7000000.htm">Проверка работоспособности</a> в ArcGIS REST API.</p><p id="GUID-10CCD4D6-1935-4717-9D69-BFC43BE1161C"> Использование <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> не является обязательным и обычно требуется, только если вы хотите получить преимущество аутентификации веб-уровня. Вы можете настроить его на том же компьютере, что и <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span>, либо на отдельном компьютере.   В любом случае, при работе с <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> необходимо настроить отдельный <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> для каждого сайта.</p></div><div class="section1" id="ESRI_SECTION1_196562782F0149D9A8D7862BA38841EB" purpose="section1"><h2>Другие соображения</h2><div class="section2" id="ESRI_SECTION2_C0955A61BFD348F68136E7289F25B83B" purpose="section2"><h3>Поддержка синхронности сервисов сайтов</h3><p id="GUID-236BE866-44C2-4547-A913-EFAC3C3B4888"> В отличие от сайта с несколькими компьютерами, эта настройка требует, чтобы все сайты под балансировщиком нагрузки имели одинаковые ресурсы и модель безопасности. Вы должны убедиться, что все сайты выглядят одинаково.</p><p id="GUID-8F3DE45D-6ADC-4E02-9070-DB09850AFCC8"> Есть несколько способов синхронизации сервисов <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> через основной и резервные сайты:</p><ul purpose="ul" id="UL_F4A876F72DBB46A397A69054C851CD96"><li purpose="li" id="LI_2402FD84A05D4D2695366E4E4B018FF4">Написание скриптов: <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> включает административный REST API, который может использоваться для написания скриптов с административными задачами, такими как публикация сервисов и изменение настроек их безопасности. Вы можете написать собственные скрипты, чтобы применить изменения ко всем участвующим в развертывании компьютерам <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span>. Написание скриптов особенно полезно в случае необходимости внесения небольших улучшений, к примеру, изменения безопасности сервиса или его перезаписывание. Подробнее см. в разделе <a class="xref" target="_blank" rel="http://server.arcgis.com/ru/server/latest/administer/windows/scripting-arcgis-server-administration.htm" href="http://server.arcgis.com/ru/server/latest/administer/windows/scripting-arcgis-server-administration.htm">Скрипты для администрирования ArcGIS Server</a>.<div class="notes" id="GUID-5134A5DB-8BC5-4DF9-980C-118EA56D6B51"><div class="note"><img class="note_img" src="rsrc/note.png" alt="Примечание" title="Примечание"><span>Примечание:</span></div><div class="tipbody"><p id="GUID-B634C6CC-937A-49DA-8C98-CD7EAFA8A785">Не используйте скрипт для создания начального сайта. Вручную создайте первый сайт на образе виртуальной машины, и закодируйте в скрипт создание дополнительных сайтов с этого образа. Создание всех машин с одного и того же образа виртуальной машины гарантирует, что все машины будут использовать одинаковый ключ шифрования.</p></div></div></li><li purpose="li" id="LI_952B7B2D50774CF58097DC68DC7094F5"> Визуализация: Создайте шаблон виртуальной машины и используйте его для запуска новых сайтов. Как упоминалось выше, это гарантирует использование единого ключа шифрования. В дополнение, каждый шаблон будет иметь копию данных для ГИС-сервисов (если не используется база данных) и всех опубликованных и настроенных сервисов. Если необходимы изменения, например, добавление или обновление имеющихся сервисов, создайте новый шаблон для последующего запуска новых виртуальных машин, которые заменят имеющийся пул машин <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> под балансировщиком нагрузки. Шаблоны виртуальных машин также можно использовать для восстановления устаревших машин <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span>.</li></ul><p id="GUID-34948C59-10A8-43D3-9F4B-0BA0299F63D9"> Рекомендуемая процедура применения изменений к сайтам:</p><div class="wfsteps" purpose="wfsteps"><h4></h4><div class="steps" id="ESRI_STEPS_784E84BE74D5437E9707B1399BAF19EE"><div class="step_title">Шаги:</div><ol><li purpose="step" id="ESRI_STEP_B00B728FB6064C4E9681C58120712FBB"><span purpose="cmd" id="GUID-212C7A42-1687-4CCF-8C9C-07B0C4F1FB24"> Административные изменения будут вначале применены к сайту, находящемуся в режиме ожидания.. Например, вы можете добавить новый сервис и изменить безопасность другого сервиса на сайте, не обрабатывающем запросы. Это обеспечит отсутствие влияния на приложения, использующие ваш основной сайт.</span></li><li purpose="step" id="ESRI_STEP_4EB66725C203433EAE03FF73D698F6EA"><span purpose="cmd" id="GUID-437B3239-C47C-4C38-B0B1-FCDD44E91446">Настройте вручную свой балансировщик нагрузки для обработки всех запросов резервным сайтом, для которого были выполнены изменения.</span></li><li purpose="step" id="ESRI_STEP_4D19A677A2694061AFDF1806C895BB3B"><span purpose="cmd" id="GUID-6350C413-0F06-4D6C-AE2D-8AE3C45F3423">Внесите те же изменения в основной сайт.</span></li><li purpose="step" id="ESRI_STEP_18542AF42544419FA949DC39C30CDBD4"><span purpose="cmd" id="GUID-43995EA3-BF8D-431F-9636-94A578E0E428">Настройте балансировщик нагрузки так, чтобы запросы направлялись опять на основной сайт и оставьте резервный сайт в режиме ожидания.</span></li></ol></div></div><p id="GUID-87CCE021-1815-4423-8A82-75FB64408A6B"> Изменения в вашем сайте в описанной выше процедуре можно применить вручную с помощью <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> Manager, скриптов и виртуальных образов.</p></div><div class="section2" id="ESRI_SECTION2_18A9D985BCFE499E9519BC5084CCB1B3" purpose="section2"><h3>Предоставление доступа к выходной директории</h3><p id="GUID-22758F5B-AC7B-46BA-8384-6B5C7A1127E7">Некоторые сервисные операции <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> ссылаются на ресурсы в одной или нескольких выходных директориях.  Например, картографические сервисы могут записывать изображения в выходную директорию и ссылаться на данные изображения посредством URL-адреса в ответе на запрос. Для того, чтобы клиенты успешно получили изображение, все сайты в конфигурации active-active должны ссылаться на одну выходную директорию. Это может быть достигнуто путем размещения выходных директории на сетевом ресурсе и предоставлением открытого доступа к ним с сайтов.</p><p id="GUID-5228E005-D886-437A-A492-AD4B96BC5DCA">Далее приведен список операций сервисов, которые будут использовать выходные директории:</p><ul purpose="ul" id="UL_68A5033169114B18B7A572649B709AA8"><li purpose="li" id="LI_77ED29AD1C4A4D34B1F219D776C28968"><a class="xref" target="_blank" rel="http://resources.arcgis.com/ru/help/arcgis-rest-api/02r3/02r3000000rp000000.htm" href="http://resources.arcgis.com/ru/help/arcgis-rest-api/02r3/02r3000000rp000000.htm">Создание реплики сервиса объектов</a> (сервис пространственных объектов)</li><li purpose="li" id="LI_7AA237DE47F14F308CFD25D74BC00B5F"><a class="xref" target="_blank" rel="http://resources.arcgis.com/ru/help/arcgis-rest-api/02r3/02r3000000s7000000.htm" href="http://resources.arcgis.com/ru/help/arcgis-rest-api/02r3/02r3000000s7000000.htm">Загрузка растрового изображения</a> (сервис изображений)</li><li purpose="li" id="LI_3CC1979547874B5F8BDC59C3F9A1500D"><a class="xref" target="_blank" rel="http://resources.arcgis.com/ru/help/arcgis-rest-api/02r3/02r3000000v7000000.htm" href="http://resources.arcgis.com/ru/help/arcgis-rest-api/02r3/02r3000000v7000000.htm">Экспорт изображения карты</a> (картографический сервис)</li><li purpose="li" id="LI_B37B3AF223C843B58948733888F8CA60"><a class="xref" target="_blank" rel="http://resources.arcgis.com/ru/help/arcgis-rest-api/02r3/02r3000000wn000000.htm" href="http://resources.arcgis.com/ru/help/arcgis-rest-api/02r3/02r3000000wn000000.htm">Экспорт схематического представления</a> (функциональные возможности schematics в картографическом сервисе)</li><li purpose="li" id="LI_F558A74F704344E8B6AAEAEB35878457"><a class="xref" target="_blank" rel="http://resources.arcgis.com/ru/help/arcgis-rest-api/02r3/02r3000001m3000000.htm" href="http://resources.arcgis.com/ru/help/arcgis-rest-api/02r3/02r3000001m3000000.htm">Экспорт веб-карты</a> (сервис геообработки)</li></ul></div><div class="section2" id="ESRI_SECTION2_7DDC0166EDAF43C494BD072E72CB2F86" purpose="section2"><h3>Асинхронное выполнение сервисов геообработки</h3><p id="GUID-A4ED5B7B-049F-41E7-8788-A76539A4ABF4">Сервисы геообработки <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> поддерживают два режима выполнения: синхронный и асинхронный.  Синхронное выполнение следует шаблону запрос-ответ на уровне сети и полностью поддерживается в конфигурации active-active. Асинхронное выполнение следует шаблону запрос-ответ с сохранением состояний и является опцией по умолчанию. Для того, чтобы использовать асинхронное выполнение в конфигурации active-active, вы должны будете рассмотреть следующее:</p><ul purpose="ul" id="UL_E514C178FA174602A1CA703EBFE88C60"><li purpose="li" id="LI_5A8AFCB46EDC489E843064159E5D4220"> При выполнении задания асинхронной обработки вы получаете ID задания, соответствующий задаче и ее выходным данным. Только сайт <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span>, принимающий исходный запрос, может распознать этот ID. По этой причине, конфигурация active-active требует определения сходства в балансировщике нагрузки (также известного как липкие сессии) для асинхронного выполнения. Это поможет вам обеспечить высокую доступность асинхронной геообработки и выходных данных картографического сервиса. Обращайтесь к поставщику вашего балансировщика нагрузки, чтобы понять последствия включения липких сессий.</li><li purpose="li" id="LI_24BDF1995314447EAF7A8DA98409374D"> Если ваш сервис геообработки не использует картографические сервисы для отображения выходных данных и не определено выходных данных типа 'Файл', то для сервисов геообработки можно выбрать синхронное выполнение. Не требуется никаких липких сессий в балансировщике нагрузки.</li></ul></div><div class="section2" id="ESRI_SECTION2_AD2A918F0F5D4FF59EEDA3502C56B77A" purpose="section2"><h3>Использование безопасности на уровне токенов</h3><p id="GUID-D8F944FD-F648-4A63-84EB-013DDE5EE2F1"> При использовании аутентификации на уровне токенов, которую также называют аутентификацией на уровне ГИС, важно, чтобы все сайты конфигурации использовали один и тот же ключ токена. В противном случае токены, созданные для одного компьютера, не подойдут для применения на другом. Чтобы узнать о дублировании общих ключей токенов для нескольких сайтов, обратитесь к разделам <a class="xref" target="_blank" rel="http://server.arcgis.com/ru/server/latest/administer/windows/about-arcgis-tokens.htm" href="http://server.arcgis.com/ru/server/latest/administer/windows/about-arcgis-tokens.htm">О токенах ArcGIS</a> и <a class="xref" target="_blank" rel="http://server.arcgis.com/ru/server/latest/administer/windows/editing-token-settings-in-manager.htm" href="http://server.arcgis.com/ru/server/latest/administer/windows/editing-token-settings-in-manager.htm">Редактирование настроек токенов в Manager</a>.</p></div></div><div class="section1" id="ESRI_SECTION1_7D80FDD6984A4CB89673169EC202AE9B" purpose="section1"><h2>Достоинства</h2><ul purpose="ul" id="UL_29B1CEDBC9B64C93B3BF5A5F2B6DDED6"><li purpose="li" id="LI_31A26F5D270D4EE3889F95C9C604163E">Концептуально простой. Минимальные взаимозависимости между компьютерами <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> позволяют легко заменять устаревшие и неисправные машины, применять обновления, добавлять и удалять машины из пула серверов <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> по мере необходимости, не прерывая сервисы или запросы.</li><li purpose="li" id="LI_720ED1C47951426CB6DBD4C224B2AA58">Если листы карты хранятся локально на каждой машине, подобная конфигурация обеспечит неплохое увеличение производительности по сравнению с сайтами с несколькими машинами. На самом деле такая конфигурация идеально подходит, если вашей целью является увеличение вместимости кэшированных картографических сервисов.</li></ul></div>
<div class="section1" id="ESRI_SECTION1_41EFAD1B165B4AD7BB2360CACBFE3F46" purpose="section1"><h2>Недостатки</h2><ul purpose="ul" id="UL_1AC3D6DF066C44FB855C935C830F5958"><li purpose="li" id="LI_F897D11D574943B4B765B6F5D3BA1B6A"> Вашей задачей является синхронизация всех сайтов. Это добавляет задачи администрирования, которые могут сделать этот шаблон развертывания непрактичным для случаев, когда у вас много компьютеров или сервисов / листов кэша, которые часто изменяются.</li><li purpose="li" id="LI_0E941DCDF0974FE092B1E24E762CA34C">Необходимы знания о балансировщиках загрузки сторонних разработчиков.</li></ul></div><div class="footer"> Copyright © 1995-2017 Esri. All rights reserved. </div></div></body></html>