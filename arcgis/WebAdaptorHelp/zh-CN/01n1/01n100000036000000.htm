<html lang="zh-cn" xml:lang="zh-cn"><head>
<META http-equiv="Content-Type" content="text/html">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><META name="description" content="反向代理服务器是在外围网络（也称为隔离区 [DMZ] 或屏蔽子网）中部署的计算机，可处理来自 Internet 的请求并将其转发到内部网络的计算机中。"><meta name="content-language" content="zh-cn"><link href="rsrc/htmlhelp.css" rel="stylesheet" type="text/css"><title>ArcGIS - 
将反向代理服务器与 Portal for ArcGIS 结合使用</title>
                <script type="text/javascript" language="JavaScript">
                    var pathL  = self.location.pathname.split ("/");
                    var fname = pathL[pathL.length-1];
                    var i = fname.lastIndexOf (".htm");
                    if (i>=0) {
                    fname = fname.substring (0, i)
                    } else {
                    //??
                    }
                    if (self.location.hash) {
				    		      fname = fname + self.location.hash;
						        }
                    self.location.replace ("../index.html#//" + fname);
                </script>
                </head><!--Publication GUID: [GUID-FB5257BE-DC53-48C6-82F8-1DA075B0A617]--><!--Topic GUID: [GUID-E452FD74-CAA7-4871-BC78-990DC4D01E03]--><body><div id="content"><div class="header"><h1>
将反向代理服务器与 Portal for ArcGIS 结合使用</h1><div id="breadcrumb"></div></div>
<p id="GUID-E6059846-9BAC-4204-8CA5-AA40D26CE425">反向代理服务器是在外围网络（也称为隔离区 [DMZ] 或屏蔽子网）中部署的计算机，可处理来自 Internet 的请求并将其转发到内部网络的计算机中。以反向代理服务器的名义转发请求会为组织防火墙后面的计算机标识进行掩膜，因此保护内部计算机免受 Internet 用户的直接攻击。可在反向代理服务器中实现附加安全功能以进一步阻止外部用户访问内部网络。</p><p id="GUID-1275121D-C786-4A30-98F5-8F46E77A2F67"> 如果您的反向代理服务器支持健康检查功能，您可以使用 <span purpose="ph" translate="no" varid="PortalForArcGIS">Portal for ArcGIS</span> 的健康检查端点来确定门户是否可以接收请求。这有助于快速确定站点中是否存在软件或硬件故障。有关详细信息，请参阅 ArcGIS REST API 中的门户<a class="xref" target="_blank" rel="http://resources.arcgis.com/zh-cn/help/arcgis-rest-api/02r3/02r300000306000000.htm" href="http://resources.arcgis.com/zh-cn/help/arcgis-rest-api/02r3/02r300000306000000.htm">健康检查</a>主题。</p>
<div class="notes" id="GUID-B752AE0F-289C-4AD2-829B-7A439E7D7FCD"><div class="caution"><img class="note_img" src="rsrc/caution.png" alt="警告" title="警告"><span>警告：</span></div><div class="tipbody"><p id="GUID-FB823391-E68A-4647-9728-6449BCA394C1"> 必须在联合任何 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 站点与您的 <span purpose="ph" translate="no" varid="ArcGIS_Enterprise_long">ArcGIS Enterprise</span> 门户之前执行本主题中详细说明的配置。取消联合 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 站点会导致多个严重后果，且不易解决。有关详细信息，请参阅<a class="xref" target="_blank" rel="http://server.arcgis.com/zh-cn/portal/latest/administer/windows/administer-a-federated-server.htm" href="http://server.arcgis.com/zh-cn/portal/latest/administer/windows/administer-a-federated-server.htm">管理联合服务器</a>。</p></div></div><div class="section1" id="ESRI_SECTION1_95330DD599D34B899A6AEF123440D24A" purpose="section1"><h2>将 <span purpose="ph" translate="no" varid="PortalForArcGIS">Portal for ArcGIS</span> 添加到反向代理服务器</h2><p id="GUID-57E96981-0F4F-4CCD-8575-3887DFF10792">将 <span purpose="ph" translate="no" varid="PortalForArcGIS">Portal for ArcGIS</span> 添加到组织的反向代理服务器之前，必须完成以下操作：</p><ul purpose="ul" id="UL_F5978DE6A82346F08A10E966A8728ACE"><li purpose="li" id="LI_85752451301946C7818E4E5249B90325"> 配置反向代理服务器上的 HTTPS（HTTP 和 HTTPS 或仅 HTTPS）。<span purpose="ph" translate="no" varid="PortalForArcGIS">Portal for ArcGIS</span> 需要 HTTPS 来进行通信。有关如何设置 HTTPS 的信息，请参阅代理服务器的产品文档。</li><li purpose="li" id="LI_F8E6F46E52544930BB282767356DEF21">如果您的门户使用的是<a class="xref" rel="01n1/01n100000029000000.htm" href="01n1/01n100000029000000.htm">集成的 Windows 身份验证</a>，则根据您的门户配置 <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span>。为此，<span purpose="ph" translate="no" varid="PortalForArcGIS">Portal for ArcGIS</span> 需要使用 <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span>，这将允许反向代理服务器与您的门户进行正常通信。有关详细说明，请参阅 <a class="xref" rel="01n1/01n10000001p000000.htm" href="01n1/01n10000001p000000.htm">IIS</a>、<a class="xref" target="_blank" rel="http://server.arcgis.com/zh-cn/portal/latest/administer/windows/configure-arcgis-web-adaptor-portal.htm" href="http://server.arcgis.com/zh-cn/portal/latest/administer/windows/configure-arcgis-web-adaptor-portal.htm">Java (Windows)</a> 或 <a class="xref" target="_blank" rel="http://server.arcgis.com/zh-cn/portal/latest/administer/windows/configure-arcgis-web-adaptor-portal.htm" href="http://server.arcgis.com/zh-cn/portal/latest/administer/windows/configure-arcgis-web-adaptor-portal.htm">Java (Linux)</a> 的配置主题。</li></ul><p id="GUID-37C824CC-8344-4847-B87E-A773A4917343"> 使用 <span purpose="ph" translate="no" varid="PortalForArcGIS">Portal for ArcGIS</span> 配置 <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> 之后，可通过直接向代理服务器指令添加组件的方式将 <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> 与组织的反向代理服务器结合使用。例如，如果您正在使用 Apache 作为反向代理服务器，则需要将 <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> 添加到 Apache web 服务器配置文件 <span class="usertext">httpd.conf</span> 的 ProxyPass 指令中：</p><div class="codeblock" purpose="codeblock"><div class="highlight"><pre><code>ProxyPass /arcgis https://webadaptorhost.domain.com/webadaptorname
ProxyPassReverse /arcgis https://webadaptorhost.domain.com/webadaptorname
</code></pre></div>
</div><p id="GUID-FE2EA9BF-35AA-4795-ADD1-53CD686B7D1C">ProxyPass 指令必须与为 <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> 指定的名称（以上示例中为 <span class="usertext">/webadaptorname</span>）相匹配。如果您站点的 URL 不是以默认字符串 <span class="usertext">/arcgis</span> 结尾，则需要指定 <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> 的非默认名称（例如 <span class="usertext">/myorg</span>）。</p><p id="GUID-9F7B9781-DE8C-4648-BA8B-71B50B1AD252">验证代理服务器是否支持 gzip 编码，以及是否已配置为允许 <span class="usertext">Accept-Encoding</span> 标头。此标头允许通过 gzip 编码压缩 HTTP 1.1 响应。例如，如果允许此标头，则加载<span purpose="ph" translate="no" varid="AGMapViewer">Map Viewer</span>的请求将向浏览器返回一个大小约为 1.4 MB 的压缩响应。如果不允许此标头或忽略此标头，则请求将向浏览器返回一个未经压缩的响应，其大小约为 6.8 MB。如果网络速度很慢，那么在不压缩响应的情况下加载<span purpose="ph" translate="no" varid="AGMapViewer">Map Viewer</span>可能需要很长时间。强烈建议您允许此标头作为反向代理服务器配置的一部分。</p><p id="GUID-74EBEF4A-6086-41E1-B684-E34751FB0F74">设置门户的 <span class="usertext">WebContextURL</span> 属性。这样可以帮助 <span purpose="ph" translate="no" varid="PortalForArcGIS">Portal for ArcGIS</span> 为发送到最终用户的所有资源构建正确的 URL。要更改 <span class="usertext">WebContextURL</span>，请执行以下操作：</p><div class="wfsteps" purpose="wfsteps"><h4></h4><div class="steps" id="GUID-6E6E7C99-8AEA-46C9-8F20-020A8CFAB3DC"><div class="step_title">步骤：</div><ol>
<li purpose="step" id="GUID-59FDE619-ABBD-4492-BFEE-28FF55DE3383">
<span purpose="cmd" id="GUID-9EA6CB2B-42D5-4CDB-B3F4-A6B7F812091D">打开 Web 浏览器并以门户组织中默认管理员角色成员的身份登录到 <a class="xref" target="_blank" rel="http://server.arcgis.com/zh-cn/portal/latest/administer/windows/about-the-arcgis-portal-directory.htm" href="http://server.arcgis.com/zh-cn/portal/latest/administer/windows/about-the-arcgis-portal-directory.htm">ArcGIS Portal Directory</a>。URL 地址格式为 <span class="usertext">https://portal.domain.com:7443/arcgis/portaladmin</span>。</span>
</li>
<li purpose="step" id="ESRI_STEP_4A71032028594FDFAE77EB6051A96881"><span purpose="cmd" id="GUID-A236D912-6825-4E73-B1DB-D8C814D49586">单击<span class="uicontrol">系统 <span class="greaterthan">&gt;</span> 属性 <span class="greaterthan">&gt;</span> 更新属性</span>。</span></li><li purpose="step" id="ESRI_STEP_0EF7E5092BE34404ABD96EE79938D1D4"><span purpose="cmd" id="GUID-063C0CE8-7348-4DDA-BB7E-7A4032491D28">在<span class="uicontrol">更新系统属性</span>对话框中，插入以下 JSON，将您自己的反向代理服务器或 DNS 别名 URL 替换为组织防火墙以外的用户所看到的 URL。</span><div class="info" purpose="info"><div class="codeblock" purpose="codeblock"><div class="highlight"><pre><code>{
   &quot;WebContextURL&quot;: &quot;https://reverseproxy.domain.com/myorg&quot;
}
</code></pre></div>
</div></div></li><li purpose="step" id="ESRI_STEP_1457CC3BB07B4B71B9EC8B3D90E02C29"><span purpose="cmd" id="GUID-2D3DBC34-4358-4CC3-97A3-A368FAFB412E">单击<span class="uicontrol">更新属性</span>。</span></li></ol></div><div class="result" id="ESRI_RESULT_E0467B285DAC41E8A139B7CE28B5FB8D" purpose="result"><p id="GUID-8C019229-BD7E-4ABB-B2A4-BB6F6254F952">  通过门户配置反向代理服务器后，现在您将通过反向代理服务器 URL 而非 <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> URL 访问门户。您在门户网站或 ArcGIS Portal Directory 中访问的任何内容都将返回反向代理服务器 URL。</p><p id="GUID-D24561C2-6370-4C50-A1B0-7BC7114463E1">应使用反向代理服务器 URL 重新执行以下管理任务：</p><ul purpose="ul" id="UL_41CD7E1BB59F467797051D32633B1739"><li purpose="li" id="LI_3CDA933062E64F718442AF43005DBC63"><a class="xref" target="_blank" rel="http://server.arcgis.com/zh-cn/portal/latest/administer/windows/federate-an-arcgis-server-site-with-your-portal.htm" href="http://server.arcgis.com/zh-cn/portal/latest/administer/windows/federate-an-arcgis-server-site-with-your-portal.htm">联合 ArcGIS Server 站点与门户</a></li><li purpose="li" id="LI_F3E155D55DBD47D1B5F99B32FC125622"><a class="xref" target="_blank" rel="http://server.arcgis.com/zh-cn/portal/latest/administer/windows/configure-services.htm" href="http://server.arcgis.com/zh-cn/portal/latest/administer/windows/configure-services.htm">配置实用程序服务</a></li></ul><p id="GUID-59AEAE25-42E1-41C5-9348-2710B487DCC2">如果已将受保护的服务以项目的形式添加到门户中，您需要删除原始项目并重新添加这些项目。这是因为原始项目使用的是 <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> URL，而非反向代理服务器 URL。有关说明，请参阅<a class="xref" target="_blank" rel="http://server.arcgis.com/zh-cn/portal/latest/administer/windows/connect-secured-services.htm" href="http://server.arcgis.com/zh-cn/portal/latest/administer/windows/connect-secured-services.htm">连接到安全服务</a>。</p></div></div></div><div class="footer"> Copyright © 1995-2017 Esri. All rights reserved. </div></div></body></html>