<html lang="zh-cn" xml:lang="zh-cn"><head>
<META http-equiv="Content-Type" content="text/html">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><META name="description" content="为消除 ArcGIS Server 层中的单点故障，单机 ArcGIS Server 站点可以故障形式进行配置，其中包含第三方负载均衡器。"><meta name="content-language" content="zh-cn"><link href="rsrc/htmlhelp.css" rel="stylesheet" type="text/css"><title>ArcGIS - 
单机高可用性（主动 - 被动）部署</title>
                <script type="text/javascript" language="JavaScript">
                    var pathL  = self.location.pathname.split ("/");
                    var fname = pathL[pathL.length-1];
                    var i = fname.lastIndexOf (".htm");
                    if (i>=0) {
                    fname = fname.substring (0, i)
                    } else {
                    //??
                    }
                    if (self.location.hash) {
				    		      fname = fname + self.location.hash;
						        }
                    self.location.replace ("../index.html#//" + fname);
                </script>
                </head><!--Publication GUID: [GUID-FB5257BE-DC53-48C6-82F8-1DA075B0A617]--><!--Topic GUID: [GUID-5BAC2F6A-272F-46A1-B7C1-2051320339BA]--><body><div id="content"><div class="header"><h1>
单机高可用性（主动 - 被动）部署</h1><div id="breadcrumb"></div></div>
<p id="GUID-36F9A1B2-A480-4256-8D70-EDA6F9381933"> 为消除 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 层中的单点故障，单机 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 站点可以以故障形式进行配置，其中包含第三方负载均衡器。</p><p id="GUID-530A2A53-6D12-423C-A75F-A29D9D8EB644"> 在高级别中，部署模式的理念是克隆单机站点，并将其两个或多个独立实例放置于负载均衡器后台，配置为主动 - 被动。负载均衡器后台的所有站点均正在运行并且能够回应服务请求时，负载均衡器仅会将请求转移至其中一个站点（指定为主站点）。如果负载均衡器检测到主站点不可用，收到的请求之后将重定向到故障或备用站点。</p><div class="image" purpose="image"><table><tr><td><img class="break" src="01n1/GUID-5C90B73D-37F7-49B6-BA71-C78FE2A76D5D-web.png" purpose="img" alt="带有备用站点的高可用性单机部署" title="带有备用站点的高可用性单机部署"></td></tr><tr><td><div class="caption" purpose="caption">带有备用站点的高可用性单机部署 管理员分别连接到每个站点。两个站点均具有相同的服务器目录和配置存储的副本。</div></td></tr></table></div><p id="GUID-B2F53AB0-20AB-4A1A-87B9-2DE1B681002F"> 故障过程将全部在 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 外部进行处理，通常可以配置为在 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 计算机完全不可用（网络或硬件故障）时触发，在某些情况下，在特定 GIS 服务或操作失败的情况下触发。</p><div class="notes" id="GUID-4AB84509-E900-4BAA-BF8A-1795C5996A5F"><div class="note"><img class="note_img" src="rsrc/note.png" alt="注" title="注"><span>注：</span></div><div class="tipbody"><p id="GUID-E7204827-F79D-4C0A-BCB5-465EBCEC4760">可针对备用或故障站点从 <span purpose="ph" varid="myesrilink"><a target="_blank" class="xref" href="https://my.esri.com/" rel="https://my.esri.com/">My Esri</a></span> 请求许可文件，不产生任何额外成本。</p></div></div><p id="GUID-582734D0-2474-450E-BA4C-513D2701FE6B"> 如果在此部署模式中有多个用于托管 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 的计算机，则该配置在技术上无法描述为多机站点，因为负载均衡器的所有后台站点都彼此独立。每个站点都由单个 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 计算机组成，并具有其自己的本地配置存储和服务器目录。</p>
<div class="section1" id="ESRI_SECTION1_6855783BE1014AAF8C9BAAA490966934" purpose="section1"><h2><span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 计算机、服务器目录和配置存储</h2><p id="GUID-14FA6DC6-BCD6-4225-ABE4-05DAC4AE0791"> 在此参考<a class="xref" rel="01n1/01n10000002w000000.htm" href="01n1/01n10000002w000000.htm">单机部署</a>中所述的注意事项。每个 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 都有自己的本地服务器目录和配置存储。这将确保发挥最佳性能并将相关性保持在最低。</p></div><div class="section1" id="ESRI_SECTION1_BF1EDC0004BA41DC802401E547D314D9" purpose="section1"><h2>数据</h2><p id="GUID-7FF07C0D-DB56-421E-AEF9-68C62417A2CA"> 如果在 GIS 服务中使用基于文件的数据源，则建议将这些数据源存储在每个本地 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 计算机上（而并非存储在网络共享上）以实现服务性能的最大化。在某些情况下，例如在处理大量影像时，在网络上共享文件可能是唯一可行的选择。如果在网络上使用共享资源中的文件，则选择高可用性配置的存储设备十分重要。</p><p id="GUID-FC892FD0-09B5-4A0E-AA48-03C3FF722C81">如果使用数据库，则可以为每个站点指定一个数据库：为主站点指定一个数据库，并为备用站点指定一个单独的数据库。为使数据库保持同步，可利用数据库复制，或根据需要利用地理数据库复制技术。或者，可利用数据库提供程序中的其他高可用性技术。</p></div><div class="section1" id="ESRI_SECTION1_E28679F50AC74EA885D013361DC0F1E5" purpose="section1"><h2>反向代理服务器</h2><p id="GUID-9605B5A1-A4C5-4E7B-80F0-F58070FF4D82"> 在此配置中，需要第三方负载均衡器。必要时，该组件将至少用于处理整个站点的负载和故障。通常，负载均衡器本身还将履行<a class="xref" rel="01n1/01n10000002r000000.htm" href="01n1/01n10000002r000000.htm">使用反向代理服务器的单机部署</a>中所述的反向代理服务器角色。在某些情况下，您可能已独立于负载均衡器配置了<a class="xref" target="_blank" rel="http://server.arcgis.com/zh-cn/server/latest/administer/windows/using-a-reverse-proxy-server-with-arcgis-server.htm" href="http://server.arcgis.com/zh-cn/server/latest/administer/windows/using-a-reverse-proxy-server-with-arcgis-server.htm">反向代理服务器</a>。</p><p id="GUID-C09E8E7A-2E5A-4CA2-9C60-6AA77BD53977">如果您的网络负载均衡器支持健康检查功能，您可以使用 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 的健康检查端点来确定站点是否可以接收请求。这有助于快速确定站点中是否存在软件或硬件故障。有关详细信息，请参阅 ArcGIS REST API 中的<a class="xref" target="_blank" rel="http://resources.arcgis.com/zh-cn/help/arcgis-rest-api/02r3/02r3000002n7000000.htm" href="http://resources.arcgis.com/zh-cn/help/arcgis-rest-api/02r3/02r3000002n7000000.htm">健康检查</a>。</p><p id="GUID-4F6CC4E8-8356-43C3-B384-011F5711C6D7"> 仅当想要使用 web 层身份验证时才需要使用 ArcGIS Web Adaptor，通常情况下可选择使用。为简单起见，可选择在 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 所在的计算机上进行配置。或者，可在指定计算机上进行配置。无论在哪种情况下，如果使用 ArcGIS Web Adaptor，则必须为每个站点配置一个单独的 ArcGIS Web Adaptor。</p></div><div class="section1" id="ESRI_SECTION1_196562782F0149D9A8D7862BA38841EB" purpose="section1"><h2>其他注意事项</h2><div class="section2" id="ESRI_SECTION2_C0955A61BFD348F68136E7289F25B83B" purpose="section2"><h3>使站点中的服务保持同步</h3><p id="GUID-236BE866-44C2-4547-A913-EFAC3C3B4888"> 与真实的多机站点不同，该配置要求负载均衡器的所有后台站点均托管完全相同的内容并遵循相同的安全性模型。您负责确保所有站点对于负载均衡器都是完全相同的。</p><p id="GUID-8F3DE45D-6ADC-4E02-9070-DB09850AFCC8"> 有多种技术可帮助您使主站点和故障站点中的 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 服务保持同步：</p><ul purpose="ul" id="UL_F4A876F72DBB46A397A69054C851CD96"><li purpose="li" id="LI_2402FD84A05D4D2695366E4E4B018FF4">脚本：<span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 包括可用于编写管理任务（例如发布服务和更改安全性设置）脚本的 RESTful 管理 API。可创建自己的脚本以对部署中包含的所有 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 进行统一更改。如果需要进行微调，例如更改服务的安全性或对其进行覆盖，则脚本编写将尤为有用。有关详细信息，请参阅<a class="xref" target="_blank" rel="http://server.arcgis.com/zh-cn/server/latest/administer/windows/scripting-arcgis-server-administration.htm" href="http://server.arcgis.com/zh-cn/server/latest/administer/windows/scripting-arcgis-server-administration.htm">编写 ArcGIS Server 管理脚本</a>。</li><li purpose="li" id="LI_952B7B2D50774CF58097DC68DC7094F5"> 虚拟化：如果在虚拟环境中进行操作，则可以创建虚拟计算机模板并将其用于启动新站点。每个模版都将具有 GIS 服务所需数据的副本（除非使用数据库）。该模版还将发布和配置所有服务。如果需要进行更改，例如添加或更新现有服务，则可创建新模板以稍后启动新的虚拟计算机，该计算机将替换负载均衡器中使用的现有 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 计算机池。虚拟计算机模板还可用于快速恢复过时的 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 计算机。</li></ul><p id="GUID-34948C59-10A8-43D3-9F4B-0BA0299F63D9"> 要在此部署模式中将更改应用于站点，建议使用以下过程：</p><div class="wfsteps" purpose="wfsteps"><h4></h4><div class="steps" id="ESRI_STEPS_784E84BE74D5437E9707B1399BAF19EE"><div class="step_title">步骤：</div><ol><li purpose="step" id="ESRI_STEP_B00B728FB6064C4E9681C58120712FBB"><span purpose="cmd" id="GUID-212C7A42-1687-4CCF-8C9C-07B0C4F1FB24"> 首先将对备用模式下的站点进行管理上的更改。例如，您将添加新服务并更改站点中没有积极处理请求的其他服务的安全性。这将确保使用主站点绝对不会对应用程序产生任何影响。</span></li><li purpose="step" id="ESRI_STEP_4EB66725C203433EAE03FF73D698F6EA"><span purpose="cmd" id="GUID-437B3239-C47C-4C38-B0B1-FCDD44E91446">手动配置负载均衡器以将所有请求移交至已进行更改的备用站点。</span></li><li purpose="step" id="ESRI_STEP_4D19A677A2694061AFDF1806C895BB3B"><span purpose="cmd" id="GUID-6350C413-0F06-4D6C-AE2D-8AE3C45F3423">对空闲站点应用相同的更改。</span></li><li purpose="step" id="ESRI_STEP_18542AF42544419FA949DC39C30CDBD4"><span purpose="cmd" id="GUID-43995EA3-BF8D-431F-9636-94A578E0E428">恢复负载均衡器，这样请求将返回初始的主站点，并使备用站点一直处于备用模式。</span></li></ol></div></div><p id="GUID-87CCE021-1815-4423-8A82-75FB64408A6B"> 可通过 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> Manager、脚本或虚拟影像手动应用上述过程中的站点更改。</p></div><div class="section2" id="ESRI_SECTION2_7A70BE1D4E11428099693C68837E9A51" purpose="section2"><h3>异步地理处理和长时间运行的任务</h3><p id="GUID-63ABF49E-433F-4944-AAC1-5820842EE1EF"> 负载均衡器切换至备用站点时，主站点中的所有活动请求都将丢失。例如，如果长时间运行的请求（例如地理处理任务）在发生故障时运行，则该任务需要在备用站点中由客户端应用程序重新启动。</p></div><div class="section2" id="ESRI_SECTION2_AD2A918F0F5D4FF59EEDA3502C56B77A" purpose="section2"><h3>使用基于令牌的安全性</h3><p id="GUID-D8F944FD-F648-4A63-84EB-013DDE5EE2F1"> 如果使用基于令牌的身份验证（也称为 GIS 层身份验证），则该配置中的所有站点使用完全相同的共享令牌密钥十分重要。否则，主站点中生成的令牌在用于备用站点时无效。要了解如何复制多个站点中共享的令牌密钥，请参考<a class="xref" target="_blank" rel="http://server.arcgis.com/zh-cn/server/latest/administer/windows/about-arcgis-tokens.htm" href="http://server.arcgis.com/zh-cn/server/latest/administer/windows/about-arcgis-tokens.htm">关于 ArcGIS 令牌</a>和<a class="xref" target="_blank" rel="http://server.arcgis.com/zh-cn/server/latest/administer/windows/editing-token-settings-in-manager.htm" href="http://server.arcgis.com/zh-cn/server/latest/administer/windows/editing-token-settings-in-manager.htm">在 Manager 中编辑令牌设置</a>。</p></div></div><div class="section1" id="ESRI_SECTION1_BF8390AFC33E4EE28CC8EFEA035E1177" purpose="section1"><h2>优点</h2><ul purpose="ul" id="UL_D574A80631724B608ABA0C3675CC3E59"><li purpose="li" id="LI_B0AE7ABEB5DE479E8502D99B03B1A1AB">通过主动 - 被动故障配置可构建多余的 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 层，而不会产生任何额外的许可费。可在不产生任何额外成本的情况下许可备用服务器。</li></ul></div><div class="section1" id="ESRI_SECTION1_9A6F1AE806F140AD80FB926FCF4A55CA" purpose="section1"><h2>缺点</h2><ul purpose="ul" id="UL_2C134694CD7344C2B3B6E70AD1BDB471"><li purpose="li" id="LI_B00353D7F391425ABB1010D183B89649">负载均衡器的所有后台站点均彼此独立。必须单独管理每个站点；站点具有其自己的本地配置存储和服务器目录。如果站点服务或数据频繁更改，则可能会增加不菲的管理开销。</li><li purpose="li" id="LI_F90D1CC466E14AA49D912E0C125EC2AC">切换至备用站点时，主站点中的任何活动请求都将丢失。</li></ul></div><div class="footer"> Copyright © 1995-2017 Esri. All rights reserved. </div></div></body></html>