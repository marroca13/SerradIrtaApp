<html lang="zh-cn" xml:lang="zh-cn"><head>
<META http-equiv="Content-Type" content="text/html">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><META name="description" content="主动 - 主动部署是通过使用其中一个故障 ArcGIS Server 计算机实现生产环境中的高可用性的方式。"><meta name="content-language" content="zh-cn"><link href="rsrc/htmlhelp.css" rel="stylesheet" type="text/css"><title>ArcGIS - 单机高可用性（主动 - 主动）部署</title>
                <script type="text/javascript" language="JavaScript">
                    var pathL  = self.location.pathname.split ("/");
                    var fname = pathL[pathL.length-1];
                    var i = fname.lastIndexOf (".htm");
                    if (i>=0) {
                    fname = fname.substring (0, i)
                    } else {
                    //??
                    }
                    if (self.location.hash) {
				    		      fname = fname + self.location.hash;
						        }
                    self.location.replace ("../index.html#//" + fname);
                </script>
                </head><!--Publication GUID: [GUID-FB5257BE-DC53-48C6-82F8-1DA075B0A617]--><!--Topic GUID: [GUID-D05F2CE7-BB97-4B83-888E-8750E42C8234]--><body><div id="content"><div class="header"><h1>单机高可用性（主动 - 主动）部署</h1><div id="breadcrumb"></div></div>
<p id="GUID-D10C0CE4-3E31-4EB5-9CF1-BB8000F12735"> 该配置是<a class="xref" rel="01n1/01n10000002s000000.htm" href="01n1/01n10000002s000000.htm">单机高可用性（主动 - 被动）部署</a>的一个变化，其中负载均衡器配置为随时在所有站点中分布负载。该配置中不存在备用站点。</p><p id="GUID-05D90C41-2896-4CA2-9E9B-BFB61C97EE67"> 在该架构中，将在第三方负载均衡器后台配置两个或多个站点以提高 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 部署的容量。可使用该技术来适应<a class="xref" rel="01n1/01n10000002w000000.htm" href="01n1/01n10000002w000000.htm">单机部署</a>和<a class="xref" rel="01n1/01n10000002r000000.htm" href="01n1/01n10000002r000000.htm">使用反向代理服务器的单机部署</a>部署方案中所述的一些高可用性限制，或通过添加更多机器进行扩展。</p><p id="GUID-58CAD460-A6FE-446A-A387-BB257F9FF7CF"> 虽然可通过使用多机站点来扩展和实现高可用性，但主动 - 主动部署仍具有其优势和限制，这将在下文中进行讨论。</p><div class="image" purpose="image"><table><tr><td><img class="break" src="01n1/GUID-90564278-838E-4EBC-9623-219347F4CCCC-web.png" purpose="img" alt="主动 - 主动部署包含两个站点" title="主动 - 主动部署包含两个站点"></td></tr><tr><td><div class="caption" purpose="caption">主动 - 主动部署包含两个站点。管理员分别连接到每个站点。两个站点均具有相同的服务器目录和配置存储的副本。</div></td></tr></table></div><p id="GUID-0E95AE0A-1D33-4BA3-8939-8CD03DD6C47A"> 在高级别中，单机主动 - 主动架构的理念是克隆单机站点，并将其独立的实例放置在负载均衡器之后。从技术角度讲，该配置不能被描述为多机站点，因为所有站点都是彼此独立的，其中每个站点都包含单个 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 计算机，并具有其自己的本地配置存储和服务器目录。</p><p id="GUID-3F39950B-CBC0-4F66-A3C8-C2EA3E97626A">多机 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 站点部署极大地简化了服务器管理。但是，主动 - 主动架构可用于符合以下条件的情况中：服务的数量和设置均已明确定义、保持静态并可以为多机站点提供巨大的性能优势，尤其是缓存地图服务。</p>
<div class="section1" id="ESRI_SECTION1_4F3569517C2B468A8E70D2523F654294" purpose="section1"><h2><span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 计算机、服务器目录和配置存储</h2><p id="GUID-DFD8B1CC-4625-4260-88FD-AECD77125A30">每个 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 计算机都必须拥有其自己的本地配置存储和缓存、作业以及系统目录。这将确保发挥最佳性能并将相关性保持在最低。相反，必须在各个站点之间共享输出目录。有关更多信息，请参阅以下<a class="xref" rel="01n1/01n10000002z000000.htm#ESRI_SECTION2_18A9D985BCFE499E9519BC5084CCB1B3" href="01n1/01n10000002z000000.htm#ESRI_SECTION2_18A9D985BCFE499E9519BC5084CCB1B3">其他注意事项</a>。</p></div><div class="section1" id="ESRI_SECTION1_D145A38FA7744A09BEF49F7BFFFBB5ED" purpose="section1"><h2>数据</h2><p id="GUID-3667FA67-0195-4578-BEE3-5D95D4A459BB"> 在此参考<a class="xref" rel="01n1/01n10000002s000000.htm" href="01n1/01n10000002s000000.htm">单机高可用性（主动 - 被动）部署</a>中所述的注意事项。</p></div><div class="section1" id="ESRI_SECTION1_8EF751A1A0674003B0A8AEE7DD7C0FAC" purpose="section1"><h2>  反向代理服务器</h2><p id="GUID-08D30EAA-3B15-4022-9815-F24432074696"> 在此配置中，需要第三方负载均衡器。该组件将至少在所有站点中分配负载。负载均衡器具有用于分配负载的不同配置，例如轮询和最少连接。选择正确的负载分配取决于您在 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 站点上运行的 web 服务及其使用模式。通常，负载均衡器还通常使用多个选项处理故障。例如，您可以将规则应用于负载均衡器，以阻止其将请求转发至因硬件或网络故障或特殊 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 服务不可用而无法使用的计算机。如果按照建议在该模式中使用单机站点，则会保证发送至特殊计算机的请求将由该计算机进行处理。</p><p id="GUID-A0ECF165-A482-4351-963D-45E5266F6145"> 通常，负载均衡器本身还将履行<a class="xref" rel="01n1/01n10000002r000000.htm" href="01n1/01n10000002r000000.htm">使用反向代理服务器的单机部署</a>中所述的反向代理服务器角色。在某些情况下，您可能已独立于负载均衡器配置了<a class="xref" target="_blank" rel="http://server.arcgis.com/zh-cn/server/latest/administer/windows/using-a-reverse-proxy-server-with-arcgis-server.htm" href="http://server.arcgis.com/zh-cn/server/latest/administer/windows/using-a-reverse-proxy-server-with-arcgis-server.htm">反向代理服务器</a>。</p><p id="GUID-F79D5977-06ED-4481-B6B3-074FFE7C8F1C">如果您的网络负载均衡器支持健康检查功能，您可以使用 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 的健康检查端点来确定站点是否可以接收请求。这有助于快速确定站点中是否存在软件或硬件故障。有关详细信息，请参阅 ArcGIS REST API 中的<a class="xref" target="_blank" rel="http://resources.arcgis.com/zh-cn/help/arcgis-rest-api/02r3/02r3000002n7000000.htm" href="http://resources.arcgis.com/zh-cn/help/arcgis-rest-api/02r3/02r3000002n7000000.htm">健康检查</a>。</p><p id="GUID-10CCD4D6-1935-4717-9D69-BFC43BE1161C"> 仅当想要使用 web 层身份验证时才需要使用 <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span>，通常情况下可选择使用。您可以选择在 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 所在的计算机上对其进行配置，也可以选择在指定计算机上进行配置。无论在哪种情况下，如果使用 <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span>，则必须为每个站点配置一个单独的 <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span>。</p></div><div class="section1" id="ESRI_SECTION1_196562782F0149D9A8D7862BA38841EB" purpose="section1"><h2>其他注意事项</h2><div class="section2" id="ESRI_SECTION2_C0955A61BFD348F68136E7289F25B83B" purpose="section2"><h3>使站点中的服务保持同步</h3><p id="GUID-236BE866-44C2-4547-A913-EFAC3C3B4888"> 与真实的多机站点不同，该配置要求负载均衡器的所有后台站点均托管完全相同的内容并遵循相同的安全性模型。您负责确保所有站点对于负载均衡器都是完全相同的。</p><p id="GUID-8F3DE45D-6ADC-4E02-9070-DB09850AFCC8"> 有多种技术可帮助您使主站点和故障站点中的 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 服务保持同步：</p><ul purpose="ul" id="UL_F4A876F72DBB46A397A69054C851CD96"><li purpose="li" id="LI_2402FD84A05D4D2695366E4E4B018FF4">脚本：<span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 包括可用于编写管理任务（例如发布服务和更改安全性设置）脚本的 RESTful 管理 API。可创建自己的脚本以对部署中包含的所有 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 计算机进行统一更改。如果需要进行微调，例如更改服务的安全性或对其进行覆盖，则脚本编写将尤为有用。有关详细信息，请参阅<a class="xref" target="_blank" rel="http://server.arcgis.com/zh-cn/server/latest/administer/windows/scripting-arcgis-server-administration.htm" href="http://server.arcgis.com/zh-cn/server/latest/administer/windows/scripting-arcgis-server-administration.htm">编写 ArcGIS Server 管理脚本</a>。<div class="notes" id="GUID-5134A5DB-8BC5-4DF9-980C-118EA56D6B51"><div class="note"><img class="note_img" src="rsrc/note.png" alt="注" title="注"><span>注：</span></div><div class="tipbody"><p id="GUID-B634C6CC-937A-49DA-8C98-CD7EAFA8A785">不要使用脚本创建初始站点。在虚拟机映像上手动创建第一个站点，然后从此基本映像创建其他站点的脚本。从同一虚拟机映像创建所有计算机可确保所有计算机使用相同的加密密钥。</p></div></div></li><li purpose="li" id="LI_952B7B2D50774CF58097DC68DC7094F5"> 虚拟化：创建虚拟机模板并用其启动新的站点。如上所述，这可确保所有计算机均使用相同的加密密钥。此外，每个模版都将具有 GIS 服务及所有已发布和配置的服务所需数据的副本（除非使用数据库）。如果需要进行更改，例如添加或更新现有服务，则可创建新模板以启动后续虚拟计算机，该计算机将替换负载均衡器中使用的现有 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 计算机池。您还可以使用虚拟机模板来恢复过时的 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 计算机。</li></ul><p id="GUID-34948C59-10A8-43D3-9F4B-0BA0299F63D9"> 要在此部署模式中将更改应用于站点，建议使用以下过程：</p><div class="wfsteps" purpose="wfsteps"><h4></h4><div class="steps" id="ESRI_STEPS_784E84BE74D5437E9707B1399BAF19EE"><div class="step_title">步骤：</div><ol><li purpose="step" id="ESRI_STEP_B00B728FB6064C4E9681C58120712FBB"><span purpose="cmd" id="GUID-212C7A42-1687-4CCF-8C9C-07B0C4F1FB24"> 对首先进入备用模式的站点进行管理更改。例如，添加新服务并更改站点中没有积极处理请求的其他服务的安全性。这将确保使用主站点不会对应用程序产生任何影响。</span></li><li purpose="step" id="ESRI_STEP_4EB66725C203433EAE03FF73D698F6EA"><span purpose="cmd" id="GUID-437B3239-C47C-4C38-B0B1-FCDD44E91446">手动配置负载均衡器以将所有请求移交至已进行更改的备用站点。</span></li><li purpose="step" id="ESRI_STEP_4D19A677A2694061AFDF1806C895BB3B"><span purpose="cmd" id="GUID-6350C413-0F06-4D6C-AE2D-8AE3C45F3423">对空闲站点应用相同的更改。</span></li><li purpose="step" id="ESRI_STEP_18542AF42544419FA949DC39C30CDBD4"><span purpose="cmd" id="GUID-43995EA3-BF8D-431F-9636-94A578E0E428">恢复负载均衡器，这样请求将返回初始的主站点，并使备用站点一直处于备用模式。</span></li></ol></div></div><p id="GUID-87CCE021-1815-4423-8A82-75FB64408A6B"> 可通过 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> Manager、脚本或虚拟影像手动应用上述过程中的站点更改。</p></div><div class="section2" id="ESRI_SECTION2_18A9D985BCFE499E9519BC5084CCB1B3" purpose="section2"><h3>输出目录共享</h3><p id="GUID-22758F5B-AC7B-46BA-8384-6B5C7A1127E7">某些 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 服务操作会引用一个或多个输出目录中的资源。例如，地图服务可能会将影像写入到输出目录，并在请求响应中通过 URL 引用这些影像。为使客户端成功获取影像，使用主动-主动配置的所有站点所引用的输出目录必须相同。通过将输出目录放置在网络资源上并将其与您的站点共享，可实现这一点。</p><p id="GUID-5228E005-D886-437A-A492-AD4B96BC5DCA">以下列出了将使用输出目录的服务操作：</p><ul purpose="ul" id="UL_68A5033169114B18B7A572649B709AA8"><li purpose="li" id="LI_77ED29AD1C4A4D34B1F219D776C28968"><a class="xref" target="_blank" rel="http://resources.arcgis.com/zh-cn/help/arcgis-rest-api/02r3/02r3000000rp000000.htm" href="http://resources.arcgis.com/zh-cn/help/arcgis-rest-api/02r3/02r3000000rp000000.htm">创建要素服务副本</a>（要素服务）</li><li purpose="li" id="LI_7AA237DE47F14F308CFD25D74BC00B5F"><a class="xref" target="_blank" rel="http://resources.arcgis.com/zh-cn/help/arcgis-rest-api/02r3/02r3000000s7000000.htm" href="http://resources.arcgis.com/zh-cn/help/arcgis-rest-api/02r3/02r3000000s7000000.htm">下载栅格影像</a>（影像服务）</li><li purpose="li" id="LI_3CC1979547874B5F8BDC59C3F9A1500D"><a class="xref" target="_blank" rel="http://resources.arcgis.com/zh-cn/help/arcgis-rest-api/02r3/02r3000000v7000000.htm" href="http://resources.arcgis.com/zh-cn/help/arcgis-rest-api/02r3/02r3000000v7000000.htm">导出地图影像</a>（地图服务）</li><li purpose="li" id="LI_B37B3AF223C843B58948733888F8CA60"><a class="xref" target="_blank" rel="http://resources.arcgis.com/zh-cn/help/arcgis-rest-api/02r3/02r3000000wn000000.htm" href="http://resources.arcgis.com/zh-cn/help/arcgis-rest-api/02r3/02r3000000wn000000.htm">导出逻辑示意图</a>（地图服务中的示意图功能）</li><li purpose="li" id="LI_F558A74F704344E8B6AAEAEB35878457"><a class="xref" target="_blank" rel="http://resources.arcgis.com/zh-cn/help/arcgis-rest-api/02r3/02r3000001m3000000.htm" href="http://resources.arcgis.com/zh-cn/help/arcgis-rest-api/02r3/02r3000001m3000000.htm">导出 web 地图</a>（地理处理服务）</li></ul></div><div class="section2" id="ESRI_SECTION2_7DDC0166EDAF43C494BD072E72CB2F86" purpose="section2"><h3>异步执行地理处理服务</h3><p id="GUID-A4ED5B7B-049F-41E7-8788-A76539A4ABF4"><span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 地理处理服务支持两种执行模式：同步和异步。同步执行遵循无状态请求-响应的模式，且完全受主动-主动配置的支持。异步执行遵循有状态的请求-响应模式，且为默认模式。要在主动-主动配置下使用异步执行，需考虑以下内容：</p><ul purpose="ul" id="UL_E514C178FA174602A1CA703EBFE88C60"><li purpose="li" id="LI_5A8AFCB46EDC489E843064159E5D4220"> 提交异步地理处理作业时，将返回给您一个作业 ID，指出所提交的作业及其输出。只有收到原始请求的 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 站点才能识别此 ID。因此，如果想要使用异步执行，主动-主动配置需要您定义负载均衡器的密切度（也称为粘滞会话）。这将会为异步地理处理和地图服务输出提供高可用性。要了解启用粘滞会话的含义，请联络您的负载均衡器供应商。</li><li purpose="li" id="LI_24BDF1995314447EAF7A8DA98409374D"> 如果您的地理处理服务未使用地图服务来渲染输出，并且尚未定义类型“文件”的输出，则可为您的地理处理服务选择同步执行。无需在负载均衡器中使用粘滞会话。</li></ul></div><div class="section2" id="ESRI_SECTION2_AD2A918F0F5D4FF59EEDA3502C56B77A" purpose="section2"><h3>使用基于令牌的安全性</h3><p id="GUID-D8F944FD-F648-4A63-84EB-013DDE5EE2F1"> 如果使用基于令牌的身份验证（也称为 GIS 层身份验证），则该配置中的所有站点使用完全相同的共享令牌密钥十分重要。否则，针对一个计算机生成的令牌在用于其他计算机时将无效。要了解如何复制多个站点中共享的令牌密钥，请参考<a class="xref" target="_blank" rel="http://server.arcgis.com/zh-cn/server/latest/administer/windows/about-arcgis-tokens.htm" href="http://server.arcgis.com/zh-cn/server/latest/administer/windows/about-arcgis-tokens.htm">关于 ArcGIS 令牌</a>和<a class="xref" target="_blank" rel="http://server.arcgis.com/zh-cn/server/latest/administer/windows/editing-token-settings-in-manager.htm" href="http://server.arcgis.com/zh-cn/server/latest/administer/windows/editing-token-settings-in-manager.htm">在 Manager 中编辑令牌设置</a>。</p></div></div><div class="section1" id="ESRI_SECTION1_7D80FDD6984A4CB89673169EC202AE9B" purpose="section1"><h2>优点</h2><ul purpose="ul" id="UL_29B1CEDBC9B64C93B3BF5A5F2B6DDED6"><li purpose="li" id="LI_31A26F5D270D4EE3889F95C9C604163E">概念上简单明了。<span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 计算机之间的最小相关性使得替换过时或出错计算机、应用升级或根据需要从 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> 池中添加和移除计算机（在不中断服务或中止请求的情况下）变得十分简单。</li><li purpose="li" id="LI_720ED1C47951426CB6DBD4C224B2AA58">如果地图切片存储在每个本地计算机上，则该配置将提供比多机站点更为出众的性能优势。事实上，如果您的目的是提高缓存地图服务的性能，则该配置将十分理想。</li></ul></div>
<div class="section1" id="ESRI_SECTION1_41EFAD1B165B4AD7BB2360CACBFE3F46" purpose="section1"><h2>缺点</h2><ul purpose="ul" id="UL_1AC3D6DF066C44FB855C935C830F5958"><li purpose="li" id="LI_F897D11D574943B4B765B6F5D3BA1B6A"> 您的责任是使所有站点保持同步。这将增加管理开销，使得该部署模式不适用于具有许多更改频繁的计算机或服务/缓存的情况。</li><li purpose="li" id="LI_0E941DCDF0974FE092B1E24E762CA34C">需要掌握第三方负载均衡器的知识。</li></ul></div><div class="footer"> Copyright © 1995-2017 Esri. All rights reserved. </div></div></body></html>