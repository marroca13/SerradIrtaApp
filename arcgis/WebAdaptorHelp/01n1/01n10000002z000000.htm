<html lang="en" xml:lang="en"><head>
<META http-equiv="Content-Type" content="text/html">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><META name="description" content="An active-active deployment is a way to achieve high availability in a production environment through the use of one failover ArcGIS Server machine."><meta name="content-language" content="en"><link href="rsrc/htmlhelp.css" rel="stylesheet" type="text/css"><title>ArcGIS - Single-machine high-availability (active-active) deployment</title>
                <script type="text/javascript" language="JavaScript">
                    var pathL  = self.location.pathname.split ("/");
                    var fname = pathL[pathL.length-1];
                    var i = fname.lastIndexOf (".htm");
                    if (i>=0) {
                    fname = fname.substring (0, i)
                    } else {
                    //??
                    }
                    if (self.location.hash) {
				    		      fname = fname + self.location.hash;
						        }
                    self.location.replace ("../index.html#//" + fname);
                </script>
                </head><!--Publication GUID: [GUID-FB5257BE-DC53-48C6-82F8-1DA075B0A617]--><!--Topic GUID: [GUID-D05F2CE7-BB97-4B83-888E-8750E42C8234]--><body><div id="content"><div class="header"><h1>Single-machine high-availability (active-active) deployment</h1><div id="breadcrumb"></div></div>
<p id="GUID-D10C0CE4-3E31-4EB5-9CF1-BB8000F12735"> This configuration is a variation of the <a class="xref" rel="01n1/01n10000002s000000.htm" href="01n1/01n10000002s000000.htm">single-machine high-availability (active-passive) deployment</a>, where the load balancer is configured to spread the load across all sites at all times. In this configuration, there are no standby sites.</p><p id="GUID-05D90C41-2896-4CA2-9E9B-BFB61C97EE67"> In this architecture, two or more sites are configured behind a third-party load balancer to increase the capacity of your <span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span>  deployment. You can use this technique to accommodate some of the high-availability limitations described in the <a class="xref" rel="01n1/01n10000002w000000.htm" href="01n1/01n10000002w000000.htm">single-machine deployment</a> and <a class="xref" rel="01n1/01n10000002r000000.htm" href="01n1/01n10000002r000000.htm">single-machine deployment with reverse proxy server</a> deployment scenarios, or to scale up by adding more machines.</p><p id="GUID-58CAD460-A6FE-446A-A387-BB257F9FF7CF"> While you can scale up and achieve high availability by using multiple-machine sites, there are advantages and limitations to active-active deployments, which are discussed below.</p><div class="image" purpose="image"><table><tr><td><img class="break" src="01n1/GUID-90564278-838E-4EBC-9623-219347F4CCCC-web.png" purpose="img" alt="Active-active deployment with two sites" title="Active-active deployment with two sites"></td></tr><tr><td><div class="caption" purpose="caption">Active-active deployment with two sites.  Administrators connect to each site separately.  Both sites have  an identical copy of the server directories and configuration store.</div></td></tr></table></div><p id="GUID-0E95AE0A-1D33-4BA3-8939-8CD03DD6C47A"> At a high level, the idea behind the single-machine active-active architecture is to clone a single-machine site and place independent instances of it behind a load balancer. Technically this configuration cannot be described as a multiple-machine site, because each of the sites is independent of each other, composed of a single <span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span> machine, and has its own local configuration store and server directories.</p><p id="GUID-3F39950B-CBC0-4F66-A3C8-C2EA3E97626A">Multiple-machine  <span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span>  site deployments greatly  simplify server administration.   However, the active-active architecture can be used in scenarios where the number and settings of services are well defined, remain static, and can provide significant performance advantages over multiple-machine sites, especially for cached map services.</p>


<div class="section1" id="ESRI_SECTION1_4F3569517C2B468A8E70D2523F654294" purpose="section1"><h2><span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span> machines, server directories, and configuration store</h2><p id="GUID-DFD8B1CC-4625-4260-88FD-AECD77125A30">Each <span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span> machine must have its own local configuration store and cache, jobs, and system directories.  This ensures maximum performance and
keeps interdependencies to a minimum.   Conversely, the output directory (or directories) must be shared between each site.   For additional details, see  <a class="xref" rel="01n1/01n10000002z000000.htm#ESRI_SECTION2_18A9D985BCFE499E9519BC5084CCB1B3" href="01n1/01n10000002z000000.htm#ESRI_SECTION2_18A9D985BCFE499E9519BC5084CCB1B3">Other considerations</a> below.</p></div><div class="section1" id="ESRI_SECTION1_D145A38FA7744A09BEF49F7BFFFBB5ED" purpose="section1"><h2>Data</h2><p id="GUID-3667FA67-0195-4578-BEE3-5D95D4A459BB"> Apply the same considerations here as described in the <a class="xref" rel="01n1/01n10000002s000000.htm" href="01n1/01n10000002s000000.htm">single-machine high-availability (active-passive) deployment</a>.</p></div><div class="section1" id="ESRI_SECTION1_8EF751A1A0674003B0A8AEE7DD7C0FAC" purpose="section1"><h2>  Reverse proxy server</h2><p id="GUID-08D30EAA-3B15-4022-9815-F24432074696"> In this configuration, a third-party load
balancer is required. At a minimum, this component distributes the load across all the sites. Load
balancers have different configurations for distributing the load,
such as round robin and least connections. Selecting
the right load distribution depends on the web services you have running on the <span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span> sites, and their patterns of use.  Load balancers also typically leverage different options for handling failures.  For example, you might apply rules in your load balancer preventing it from  forwarding requests to a machine that is unavailable due to a hardware or network failure or a particular <span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span>  service that is not available.   If using single-machine sites as
proposed in this pattern, requests sent to a particular machine are guaranteed to be handled by that machine.</p><p id="GUID-A0ECF165-A482-4351-963D-45E5266F6145"> Typically, the load balancer itself also
fulfills the role of the reverse proxy server as described in <a class="xref" rel="01n1/01n10000002r000000.htm" href="01n1/01n10000002r000000.htm">Single-machine deployment with reverse proxy server</a>. In some scenarios, you
may have already configured a <a class="xref" target="_blank" rel="http://server.arcgis.com/en/server/latest/administer/windows/using-a-reverse-proxy-server-with-arcgis-server.htm" href="http://server.arcgis.com/en/server/latest/administer/windows/using-a-reverse-proxy-server-with-arcgis-server.htm">reverse proxy server</a> independently from the
load balancer.</p><p id="GUID-F79D5977-06ED-4481-B6B3-074FFE7C8F1C">If your network load balancer supports a health check function, you can use <span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span>'s heath check endpoint to determine if the site is available to receive requests.  This is useful to quickly determine if there's a  software or hardware failure in the site.  For more information, see <a class="xref" target="_blank" rel="http://resources.arcgis.com/en/help/arcgis-rest-api/02r3/02r3000002n7000000.htm" href="http://resources.arcgis.com/en/help/arcgis-rest-api/02r3/02r3000002n7000000.htm">Health Check</a> in the ArcGIS REST API.</p><p id="GUID-10CCD4D6-1935-4717-9D69-BFC43BE1161C"> The use of <span purpose="ph" varid="WebAdaptorforArcGIS" translate="no">ArcGIS Web Adaptor</span> is optional and typically only necessary for this scenario if you would like to take advantage of web tier authentication. You can choose to configure it in the same machine as your <span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span>, or alternatively you can configure it in a dedicated machine.   In either case, if using <span purpose="ph" varid="WebAdaptorforArcGIS" translate="no">ArcGIS Web Adaptor</span>, you must configure a separate <span purpose="ph" varid="WebAdaptorforArcGIS" translate="no">ArcGIS Web Adaptor</span> for every site.</p></div><div class="section1" id="ESRI_SECTION1_196562782F0149D9A8D7862BA38841EB" purpose="section1"><h2>Other considerations</h2><div class="section2" id="ESRI_SECTION2_C0955A61BFD348F68136E7289F25B83B" purpose="section2"><h3>Keeping the services in your sites in sync</h3><p id="GUID-236BE866-44C2-4547-A913-EFAC3C3B4888"> Unlike a true multiple-machine site,
this configuration requires that all of the
sites behind the load balancer host exactly
the same content and that they follow the same security model. You
are responsible for ensuring that all the sites look exactly
the same to the load balancer.</p><p id="GUID-8F3DE45D-6ADC-4E02-9070-DB09850AFCC8"> There are multiple techniques that can help you keep <span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span>  services in sync across the primary and failover sites:</p><ul purpose="ul" id="UL_F4A876F72DBB46A397A69054C851CD96"><li purpose="li" id="LI_2402FD84A05D4D2695366E4E4B018FF4">Scripting: <span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span>  includes a RESTful administrative API that you can use to script
administrative tasks, such as publishing services and changing their
security settings. You can create your own scripts to apply changes
to all the <span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span> machines involved in your deployment consistently.
Scripting is especially useful when you need to make small
adjustments, such as changing the security of a service or
overwriting it.  For more information, see <a class="xref" target="_blank" rel="http://server.arcgis.com/en/server/latest/administer/windows/scripting-arcgis-server-administration.htm" href="http://server.arcgis.com/en/server/latest/administer/windows/scripting-arcgis-server-administration.htm">Scripting ArcGIS Server administration</a>.<div class="notes" id="GUID-5134A5DB-8BC5-4DF9-980C-118EA56D6B51"><div class="note"><img class="note_img" src="rsrc/note.png" alt="Note" title="Note"><span>Note:</span></div><div class="tipbody"><p id="GUID-B634C6CC-937A-49DA-8C98-CD7EAFA8A785">Do not use a script to create the initial site. Manually create the first site on a virtual machine image, and script creation of additional sites from this base image. Creating all machines from the same virtual machine image ensures that all machines use the same encryption key.</p></div></div></li><li purpose="li" id="LI_952B7B2D50774CF58097DC68DC7094F5"> Virtualization: Create a virtual machine template and use it to launch new sites. As mentioned above, this ensures all machines use the same encryption key. In addition, each template
will have a copy of the data needed for
GIS services (unless a database is used) and all published and configured services. If changes are necessary, such as adding or updating
existing services, create a new template to launch
subsequent virtual machines that would replace the existing pool of <span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span> machines in use under the load balancer. You can also use virtual machine templates
to recover stale <span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span> machines.</li></ul><p id="GUID-34948C59-10A8-43D3-9F4B-0BA0299F63D9"> The recommended procedure to apply changes to your sites in this deployment pattern is as follows:</p><div class="wfsteps" purpose="wfsteps"><h4></h4><div class="steps" id="ESRI_STEPS_784E84BE74D5437E9707B1399BAF19EE"><div class="step_title">Steps:</div><ol><li purpose="step" id="ESRI_STEP_B00B728FB6064C4E9681C58120712FBB"><span purpose="cmd" id="GUID-212C7A42-1687-4CCF-8C9C-07B0C4F1FB24"> Make administrative changes against
a site that is in standby mode first. For example, add a
new service and change the security of another in a site that is
not actively handling requests. This ensures there is no impact
to applications using your primary site.</span></li><li purpose="step" id="ESRI_STEP_4EB66725C203433EAE03FF73D698F6EA"><span purpose="cmd" id="GUID-437B3239-C47C-4C38-B0B1-FCDD44E91446">Manually configure your load balancer to hand over
all requests to the standby site on which the changes have
been made.</span></li><li purpose="step" id="ESRI_STEP_4D19A677A2694061AFDF1806C895BB3B"><span purpose="cmd" id="GUID-6350C413-0F06-4D6C-AE2D-8AE3C45F3423">Apply the same changes to the idle site.</span></li><li purpose="step" id="ESRI_STEP_18542AF42544419FA949DC39C30CDBD4"><span purpose="cmd" id="GUID-43995EA3-BF8D-431F-9636-94A578E0E428">Revert the load balancer so requests are directed
back to the original primary site and leave the standby site in
standby mode.</span></li></ol></div></div><p id="GUID-87CCE021-1815-4423-8A82-75FB64408A6B"> Changes to your site in the procedure described above can be applied manually through <span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span>  Manager, scripts, or virtual images.</p></div><div class="section2" id="ESRI_SECTION2_18A9D985BCFE499E9519BC5084CCB1B3" purpose="section2"><h3>Output directory sharing</h3><p id="GUID-22758F5B-AC7B-46BA-8384-6B5C7A1127E7">Some <span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span>  service operations reference resources in one or more output directories.  For example, map services can write images to an output directory and reference these images through a URL in the request response.  For clients to successfully obtain the image, all sites in your active-active configuration must reference the same output directory.  This can be accomplished by placing the output directories on a network resource and sharing them with your sites.</p><p id="GUID-5228E005-D886-437A-A492-AD4B96BC5DCA">The following is a list of service operations that use output directories:</p><ul purpose="ul" id="UL_68A5033169114B18B7A572649B709AA8"><li purpose="li" id="LI_77ED29AD1C4A4D34B1F219D776C28968"><a class="xref" target="_blank" rel="http://resources.arcgis.com/en/help/arcgis-rest-api/02r3/02r3000000rp000000.htm" href="http://resources.arcgis.com/en/help/arcgis-rest-api/02r3/02r3000000rp000000.htm">Creating a feature service replica</a> (feature service)</li><li purpose="li" id="LI_7AA237DE47F14F308CFD25D74BC00B5F"><a class="xref" target="_blank" rel="http://resources.arcgis.com/en/help/arcgis-rest-api/02r3/02r3000000s7000000.htm" href="http://resources.arcgis.com/en/help/arcgis-rest-api/02r3/02r3000000s7000000.htm">Downloading a raster image</a> (image service)</li><li purpose="li" id="LI_3CC1979547874B5F8BDC59C3F9A1500D"><a class="xref" target="_blank" rel="http://resources.arcgis.com/en/help/arcgis-rest-api/02r3/02r3000000v7000000.htm" href="http://resources.arcgis.com/en/help/arcgis-rest-api/02r3/02r3000000v7000000.htm">Exporting a map image</a> (map service)</li><li purpose="li" id="LI_B37B3AF223C843B58948733888F8CA60"><a class="xref" target="_blank" rel="http://resources.arcgis.com/en/help/arcgis-rest-api/02r3/02r3000000wn000000.htm" href="http://resources.arcgis.com/en/help/arcgis-rest-api/02r3/02r3000000wn000000.htm">Exporting a schematic diagram</a> (schematics capability in a map service)</li><li purpose="li" id="LI_F558A74F704344E8B6AAEAEB35878457"><a class="xref" target="_blank" rel="http://resources.arcgis.com/en/help/arcgis-rest-api/02r3/02r3000001m3000000.htm" href="http://resources.arcgis.com/en/help/arcgis-rest-api/02r3/02r3000001m3000000.htm">Exporting a web map</a> (geoprocessing service)</li></ul></div><div class="section2" id="ESRI_SECTION2_7DDC0166EDAF43C494BD072E72CB2F86" purpose="section2"><h3>Asynchronous execution of geoprocessing services</h3><p id="GUID-A4ED5B7B-049F-41E7-8788-A76539A4ABF4"><span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span>  geoprocessing services support two execution modes: synchronous and asynchronous.  Synchronous execution follows a stateless request-response pattern and is completely supported in an active-active configuration.  Asynchronous execution follows a stateful request-response pattern and is the default.  In order to use asynchronous execution in an active-active configuration, you'll need to consider the following:</p><ul purpose="ul" id="UL_E514C178FA174602A1CA703EBFE88C60"><li purpose="li" id="LI_5A8AFCB46EDC489E843064159E5D4220"> When submitting an asynchronous geoprocessing job, you're returned a job ID that refers to the submitted job and its outputs. Only the <span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span>  site that receives the original can recognize this ID. For this reason, the active-active configuration requires you to define affinity in your load balancer (also known as sticky sessions) if you would like to use asynchronous execution. This helps provide high availability for asynchronous geoprocessing and map service outputs. Refer to your load balancer vendor to understand the implications of enabling sticky sessions.</li><li purpose="li" id="LI_24BDF1995314447EAF7A8DA98409374D"> If your geoprocessing service does not use map services to render outputs and no outputs of type 'File' have been defined, you can select synchronous execution for your geoprocessing services. No sticky sessions in your load balancer are required.</li></ul></div><div class="section2" id="ESRI_SECTION2_AD2A918F0F5D4FF59EEDA3502C56B77A" purpose="section2"><h3>Using token-based security</h3><p id="GUID-D8F944FD-F648-4A63-84EB-013DDE5EE2F1"> If using token-based authentication,
also referred to as GIS tier authentication, it is important that
all sites in this configuration use exactly the same shared
token key. Otherwise, tokens generated for one machine will not be
valid when used against the other machine. To learn how to duplicate
the shared token keys across multiple sites, refer to <a class="xref" target="_blank" rel="http://server.arcgis.com/en/server/latest/administer/windows/about-arcgis-tokens.htm" href="http://server.arcgis.com/en/server/latest/administer/windows/about-arcgis-tokens.htm">About ArcGIS tokens</a> and <a class="xref" target="_blank" rel="http://server.arcgis.com/en/server/latest/administer/windows/editing-token-settings-in-manager.htm" href="http://server.arcgis.com/en/server/latest/administer/windows/editing-token-settings-in-manager.htm">Editing token settings in Manager</a>.</p></div></div><div class="section1" id="ESRI_SECTION1_7D80FDD6984A4CB89673169EC202AE9B" purpose="section1"><h2>Advantages</h2><ul purpose="ul" id="UL_29B1CEDBC9B64C93B3BF5A5F2B6DDED6"><li purpose="li" id="LI_31A26F5D270D4EE3889F95C9C604163E">Conceptually straightforward. Minimal interdependencies between <span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span> machines make it easy to replace stale or faulty machines, apply upgrades, or add and remove machines from the pool of <span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span>s as needed without interrupting services or aborting requests.</li><li purpose="li" id="LI_720ED1C47951426CB6DBD4C224B2AA58">If  map tiles are stored locally on every machine, this configuration provides significant performance advantages as compared to multiple-machine sites.    In fact, this configuration is ideal if your objective is to increase the capacity of cached map services.</li></ul></div>
<div class="section1" id="ESRI_SECTION1_41EFAD1B165B4AD7BB2360CACBFE3F46" purpose="section1"><h2>Disadvantages</h2><ul purpose="ul" id="UL_1AC3D6DF066C44FB855C935C830F5958"><li purpose="li" id="LI_F897D11D574943B4B765B6F5D3BA1B6A"> It is your responsibility to keep all sites in sync. This adds an administrative overhead that can make this deployment pattern impractical for cases where you have many machines or services/caches that change frequently.</li><li purpose="li" id="LI_0E941DCDF0974FE092B1E24E762CA34C">Requires knowledge of third-party load balancers.</li></ul></div><div class="footer"> Copyright © 1995-2017 Esri. All rights reserved. </div></div></body></html>