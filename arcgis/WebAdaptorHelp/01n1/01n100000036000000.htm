<html lang="en" xml:lang="en"><head>
<META http-equiv="Content-Type" content="text/html">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><META name="description" content="A reverse proxy server is a computer that is deployed within a
perimeter network (also known as a demilitarized zone [DMZ] or
screened subnet) that handles requests from the Internet and
forwards them to the machines in your internal network."><meta name="content-language" content="en"><link href="rsrc/htmlhelp.css" rel="stylesheet" type="text/css"><title>ArcGIS - 
Use a reverse proxy server with Portal for ArcGIS</title>
                <script type="text/javascript" language="JavaScript">
                    var pathL  = self.location.pathname.split ("/");
                    var fname = pathL[pathL.length-1];
                    var i = fname.lastIndexOf (".htm");
                    if (i>=0) {
                    fname = fname.substring (0, i)
                    } else {
                    //??
                    }
                    if (self.location.hash) {
				    		      fname = fname + self.location.hash;
						        }
                    self.location.replace ("../index.html#//" + fname);
                </script>
                </head><!--Publication GUID: [GUID-FB5257BE-DC53-48C6-82F8-1DA075B0A617]--><!--Topic GUID: [GUID-E452FD74-CAA7-4871-BC78-990DC4D01E03]--><body><div id="content"><div class="header"><h1>
Use a reverse proxy server with Portal for ArcGIS</h1><div id="breadcrumb"></div></div>
<p id="GUID-E6059846-9BAC-4204-8CA5-AA40D26CE425">A reverse proxy server is a computer that is deployed within a
perimeter network (also known as a demilitarized zone [DMZ] or
screened subnet) that handles requests from the Internet and
forwards them to the machines in your internal network. The
forwarding of requests on behalf of the reverse proxy server masks
the identity of the machines behind your organization's firewall,
thus protecting internal machines from being attacked directly by
Internet users. Additional security functions can be implemented in
the reverse proxy server to further protect your internal network
from outside users.</p><p id="GUID-1275121D-C786-4A30-98F5-8F46E77A2F67"> If your reverse proxy server supports a health check function, you can use the <span purpose="ph" varid="PortalForArcGIS" translate="no">Portal for ArcGIS</span> heath check end point to determine if the portal is available to receive requests. This is useful to quickly determine if there's a software or hardware failure in the site. For more information, see the portal <a class="xref" target="_blank" rel="http://resources.arcgis.com/en/help/arcgis-rest-api/02r3/02r300000306000000.htm" href="http://resources.arcgis.com/en/help/arcgis-rest-api/02r3/02r300000306000000.htm">Health Check</a> topic in the ArcGIS REST API.</p>


<div class="notes" id="GUID-B752AE0F-289C-4AD2-829B-7A439E7D7FCD"><div class="caution"><img class="note_img" src="rsrc/caution.png" alt="Caution" title="Caution"><span>Caution:</span></div><div class="tipbody"><p id="GUID-FB823391-E68A-4647-9728-6449BCA394C1"> The configuration detailed in this topic must be performed before federating any <span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span> site with your <span purpose="ph" varid="ArcGIS_Enterprise_long" translate="no">ArcGIS Enterprise</span> portal. Unfederating an <span purpose="ph" varid="ArcGISforServer" translate="no">ArcGIS Server</span> site has several significant consequences, and is not easily undone. To learn more, see <a class="xref" target="_blank" rel="http://server.arcgis.com/en/portal/latest/administer/windows/administer-a-federated-server.htm" href="http://server.arcgis.com/en/portal/latest/administer/windows/administer-a-federated-server.htm">Administer a federated server</a>.</p></div></div><div class="section1" id="ESRI_SECTION1_95330DD599D34B899A6AEF123440D24A" purpose="section1"><h2>Add <span purpose="ph" varid="PortalForArcGIS" translate="no">Portal for ArcGIS</span> to your reverse proxy server</h2><p id="GUID-57E96981-0F4F-4CCD-8575-3887DFF10792">Before adding  <span purpose="ph" varid="PortalForArcGIS" translate="no">Portal for ArcGIS</span> to your organization's reverse proxy server, you must complete the following:</p><ul purpose="ul" id="UL_F5978DE6A82346F08A10E966A8728ACE"><li purpose="li" id="LI_85752451301946C7818E4E5249B90325"> Configure HTTPS (HTTP and HTTPS or HTTPS-only) on the reverse proxy server. <span purpose="ph" varid="PortalForArcGIS" translate="no">Portal for ArcGIS</span> requires HTTPS for some communication. Consult the product documentation for your proxy server to learn how to set up HTTPS.</li><li purpose="li" id="LI_F8E6F46E52544930BB282767356DEF21">Configure <span purpose="ph" varid="WebAdaptorforArcGIS" translate="no">ArcGIS Web Adaptor</span> with your portal if your portal will use <a class="xref" rel="01n1/01n100000029000000.htm" href="01n1/01n100000029000000.htm">Integrated Windows Authentication</a>.   <span purpose="ph" varid="PortalForArcGIS" translate="no">Portal for ArcGIS</span> requires the use of  <span purpose="ph" varid="WebAdaptorforArcGIS" translate="no">ArcGIS Web Adaptor</span> for this purpose, and this will allow the  reverse proxy server to communicate with your portal correctly.  For full instructions, see the configuration topics for <a class="xref" rel="01n1/01n10000001p000000.htm" href="01n1/01n10000001p000000.htm">IIS</a>, <a class="xref" target="_blank" rel="http://server.arcgis.com/en/portal/latest/administer/windows/configure-arcgis-web-adaptor-portal.htm" href="http://server.arcgis.com/en/portal/latest/administer/windows/configure-arcgis-web-adaptor-portal.htm">Java (Windows)</a>, or <a class="xref" target="_blank" rel="http://server.arcgis.com/en/portal/latest/administer/windows/configure-arcgis-web-adaptor-portal.htm" href="http://server.arcgis.com/en/portal/latest/administer/windows/configure-arcgis-web-adaptor-portal.htm">Java (Linux)</a>.</li></ul><p id="GUID-37C824CC-8344-4847-B87E-A773A4917343"> After configuring <span purpose="ph" varid="WebAdaptorforArcGIS" translate="no">ArcGIS Web Adaptor</span> with <span purpose="ph" varid="PortalForArcGIS" translate="no">Portal for ArcGIS</span>, <span purpose="ph" varid="WebAdaptorforArcGIS" translate="no">ArcGIS Web Adaptor</span> can be used with your organization's reverse proxy server by adding the components directly to proxy server directives. For example, if you're using Apache as a reverse proxy server, you need to add <span purpose="ph" varid="WebAdaptorforArcGIS" translate="no">ArcGIS Web Adaptor</span>  to the ProxyPass directives in the Apache web server configuration file <span class="usertext">httpd.conf</span>:</p><div class="codeblock" purpose="codeblock"><div class="highlight"><pre><code>ProxyPass /arcgis https://webadaptorhost.domain.com/webadaptorname
ProxyPassReverse /arcgis https://webadaptorhost.domain.com/webadaptorname
</code></pre></div>
</div><p id="GUID-FE2EA9BF-35AA-4795-ADD1-53CD686B7D1C">The ProxyPass directives must match the name designated for <span purpose="ph" varid="WebAdaptorforArcGIS" translate="no">ArcGIS Web Adaptor</span> (<span class="usertext">/webadaptorname</span> in the sample above).  If the URL to your site does not end with the default string <span class="usertext">/arcgis</span>, specify the nondefault name of <span purpose="ph" varid="WebAdaptorforArcGIS" translate="no">ArcGIS Web Adaptor</span> (for example, <span class="usertext">/myorg</span>).</p><p id="GUID-9F7B9781-DE8C-4648-BA8B-71B50B1AD252">Verify that the proxy server supports gzip encoding and is configured to allow the
<span class="usertext">Accept-Encoding</span> header. This header allows HTTP 1.1 responses to be
compressed using gzip encoding. For example, if the header is
allowed, a request to load  <span purpose="ph" varid="AGMapViewer" translate="no">Map Viewer</span> will return a compressed
response of approximately 1.4 MB to the browser. If the header is
not allowed or ignored, the request will return an uncompressed
response of approximately 6.8 MB to the browser. If your network
speed is slow, it may take a long time for  <span purpose="ph" varid="AGMapViewer" translate="no">Map Viewer</span> to load
if responses are not compressed. It's highly recommended that you
allow this header as part of your reverse proxy server
configuration.</p><p id="GUID-74EBEF4A-6086-41E1-B684-E34751FB0F74">Set the portal's  <span class="usertext">WebContextURL</span> property. This helps <span purpose="ph" varid="PortalForArcGIS" translate="no">Portal for ArcGIS</span> construct the correct URLs on all resources it sends to the end user. Do the following to change the <span class="usertext">WebContextURL</span>:</p><div class="wfsteps" purpose="wfsteps"><h4></h4><div class="steps" id="GUID-6E6E7C99-8AEA-46C9-8F20-020A8CFAB3DC"><div class="step_title">Steps:</div><ol>
<li purpose="step" id="GUID-59FDE619-ABBD-4492-BFEE-28FF55DE3383">
<span purpose="cmd" id="GUID-9EA6CB2B-42D5-4CDB-B3F4-A6B7F812091D">Open a web browser and sign in to the <a class="xref" target="_blank" rel="http://server.arcgis.com/en/portal/latest/administer/windows/about-the-arcgis-portal-directory.htm" href="http://server.arcgis.com/en/portal/latest/administer/windows/about-the-arcgis-portal-directory.htm">ArcGIS Portal Directory</a> as a member of the default administrator role in  your portal organization. The URL is formatted <span class="usertext">https://portal.domain.com:7443/arcgis/portaladmin</span>.</span>
</li>
<li purpose="step" id="ESRI_STEP_4A71032028594FDFAE77EB6051A96881"><span purpose="cmd" id="GUID-A236D912-6825-4E73-B1DB-D8C814D49586">Click <span class="uicontrol">System <span class="greaterthan">&gt;</span> Properties <span class="greaterthan">&gt;</span> Update Properties</span>.</span></li><li purpose="step" id="ESRI_STEP_0EF7E5092BE34404ABD96EE79938D1D4"><span purpose="cmd" id="GUID-063C0CE8-7348-4DDA-BB7E-7A4032491D28">On the <span class="uicontrol">Update System Properties</span> dialog box, insert the following JSON, substituting your own reverse proxy server or DNS alias URL as seen by users outside your organization's firewall.</span><div class="info" purpose="info"><div class="codeblock" purpose="codeblock"><div class="highlight"><pre><code>{
   &quot;WebContextURL&quot;: &quot;https://reverseproxy.domain.com/myorg&quot;
}
</code></pre></div>
</div></div></li><li purpose="step" id="ESRI_STEP_1457CC3BB07B4B71B9EC8B3D90E02C29"><span purpose="cmd" id="GUID-2D3DBC34-4358-4CC3-97A3-A368FAFB412E">Click <span class="uicontrol">Update Properties</span>.</span></li></ol></div><div class="result" id="ESRI_RESULT_E0467B285DAC41E8A139B7CE28B5FB8D" purpose="result"><p id="GUID-8C019229-BD7E-4ABB-B2A4-BB6F6254F952">  Once you've configured the reverse proxy server with your portal, you'll now access your portal through the reverse proxy server URL instead of the <span purpose="ph" varid="WebAdaptorforArcGIS" translate="no">ArcGIS Web Adaptor</span> URL. Anything you access in the portal website or the ArcGIS Portal Directory will return the reverse proxy server URL.</p><p id="GUID-D24561C2-6370-4C50-A1B0-7BC7114463E1">The following administrative tasks should be redone using the
reverse proxy server URL:</p><ul purpose="ul" id="UL_41CD7E1BB59F467797051D32633B1739"><li purpose="li" id="LI_3CDA933062E64F718442AF43005DBC63"><a class="xref" target="_blank" rel="http://server.arcgis.com/en/portal/latest/administer/windows/federate-an-arcgis-server-site-with-your-portal.htm" href="http://server.arcgis.com/en/portal/latest/administer/windows/federate-an-arcgis-server-site-with-your-portal.htm">Federate an ArcGIS Server site with your portal</a></li><li purpose="li" id="LI_F3E155D55DBD47D1B5F99B32FC125622"><a class="xref" target="_blank" rel="http://server.arcgis.com/en/portal/latest/administer/windows/configure-services.htm" href="http://server.arcgis.com/en/portal/latest/administer/windows/configure-services.htm">Configure utility services</a></li></ul><p id="GUID-59AEAE25-42E1-41C5-9348-2710B487DCC2">If you've previously added  secured services as items in your portal, you'll need to delete the original items and add them again.  This is because the original items use the <span purpose="ph" varid="WebAdaptorforArcGIS" translate="no">ArcGIS Web Adaptor</span> URL instead of the reverse proxy server URL.  For instructions, see <a class="xref" target="_blank" rel="http://server.arcgis.com/en/portal/latest/administer/windows/connect-secured-services.htm" href="http://server.arcgis.com/en/portal/latest/administer/windows/connect-secured-services.htm">Connect to secure services</a>.</p></div></div></div><div class="footer"> Copyright Â© 1995-2017 Esri. All rights reserved. </div></div></body></html>