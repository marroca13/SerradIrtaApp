<html lang="ja" xml:lang="ja"><head>
<META http-equiv="Content-Type" content="text/html">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><META name="description" content="アクティブ/アクティブの配置は、1 台のフェイルオーバー用 ArcGIS Server コンピューターを使用して、本番環境における高可用性を実現する手段です。"><meta name="content-language" content="ja"><link href="rsrc/htmlhelp.css" rel="stylesheet" type="text/css"><title>ArcGIS - 単一コンピューターの高可用性配置 (アクティブ/アクティブ)</title>
                <script type="text/javascript" language="JavaScript">
                    var pathL  = self.location.pathname.split ("/");
                    var fname = pathL[pathL.length-1];
                    var i = fname.lastIndexOf (".htm");
                    if (i>=0) {
                    fname = fname.substring (0, i)
                    } else {
                    //??
                    }
                    if (self.location.hash) {
				    		      fname = fname + self.location.hash;
						        }
                    self.location.replace ("../index.html#//" + fname);
                </script>
                </head><!--Publication GUID: [GUID-FB5257BE-DC53-48C6-82F8-1DA075B0A617]--><!--Topic GUID: [GUID-D05F2CE7-BB97-4B83-888E-8750E42C8234]--><body><div id="content"><div class="header"><h1>単一コンピューターの高可用性配置 (アクティブ/アクティブ)</h1><div id="breadcrumb"></div></div>
<p id="GUID-D10C0CE4-3E31-4EB5-9CF1-BB8000F12735"> この構成は、ロード バランサーが常にすべてのサイトに負荷を分散するよう構成される、<a class="xref" rel="01n1/01n10000002s000000.htm" href="01n1/01n10000002s000000.htm">単一コンピューターの高可用性配置 (アクティブ/パッシブ)</a> のバリエーションです。この構成ではスタンバイ サイトは存在しません。</p><p id="GUID-05D90C41-2896-4CA2-9E9B-BFB61C97EE67"> このアーキテクチャでは、<span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> の配置のキャパシティを増やすために、2 つ以上のサイトがサードパーティ製ロード バランサーの内側に構成されます。この手法は、「<a class="xref" rel="01n1/01n10000002w000000.htm" href="01n1/01n10000002w000000.htm">単一コンピューターの配置</a>」および「<a class="xref" rel="01n1/01n10000002r000000.htm" href="01n1/01n10000002r000000.htm">リバース プロキシ サーバーを使用した単一コンピューターの配置</a>」で述べたいくつかの高可用性の制限に対応するため、またはコンピューターを追加してスケール アップするために使用できます。</p><p id="GUID-58CAD460-A6FE-446A-A387-BB257F9FF7CF"> 複数コンピューターによるサイトを使用することでスケール アップし、高可用性を実現できますが、アクティブ/アクティブの配置にはメリットと制限事項があります。以下ではこれらのメリットと制限事項について説明します。</p><div class="image" purpose="image"><table><tr><td><img class="break" src="01n1/GUID-90564278-838E-4EBC-9623-219347F4CCCC-web.png" purpose="img" alt="2 つのサイトを使用したアクティブ/アクティブの配置" title="2 つのサイトを使用したアクティブ/アクティブの配置"></td></tr><tr><td><div class="caption" purpose="caption">2 つのサイトを使用したアクティブ/アクティブの配置。管理者は各サイトに個別に接続します。いずれのサイトも、サーバー ディレクトリと構成ストアの同一のコピーを備えています。</div></td></tr></table></div><p id="GUID-0E95AE0A-1D33-4BA3-8939-8CD03DD6C47A"> 概説すると、単一コンピューターのアクティブ/アクティブ アーキテクチャの概念は、単一コンピューターのサイトのクローンを作成して、そのサイトのインスタンスをロード バランサーの内側に独立して配置するというものです。この構成は厳密には複数コンピューターのサイトと呼ぶことはできません。その理由は、それぞれのサイトが互いに独立し、1 台の <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> コンピューターから構成され、独自の構成ストアとサーバー ディレクトリを備えているからです。</p><p id="GUID-3F39950B-CBC0-4F66-A3C8-C2EA3E97626A">複数コンピューターの <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> サイト配置では、サーバーの管理を大幅に簡素化できます。しかし、サービスの数と設定が明確に定義され、静的なままであるシナリオでは、アクティブ/アクティブ アーキテクチャを使用することで、複数コンピューターのサイトを大きく凌ぐパフォーマンス上のメリットを得ることができます。これは、特にキャッシュ マップ サービスの場合に当てはまります。</p>
<div class="section1" id="ESRI_SECTION1_4F3569517C2B468A8E70D2523F654294" purpose="section1"><h2><span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> コンピューター、サーバー ディレクトリ、および構成ストア</h2><p id="GUID-DFD8B1CC-4625-4260-88FD-AECD77125A30">各 <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> コンピューターには、独自のローカル構成ストアとキャッシュ、ジョブ、およびシステム ディレクトリが存在する必要があります。これにより、最大限のパフォーマンスが保証され、相互依存性を最小限に維持できます。反対に出力ディレクトリは、各サイト間で共有される必要があります。詳細については、下の「<a class="xref" rel="01n1/01n10000002z000000.htm#ESRI_SECTION2_18A9D985BCFE499E9519BC5084CCB1B3" href="01n1/01n10000002z000000.htm#ESRI_SECTION2_18A9D985BCFE499E9519BC5084CCB1B3">その他の考慮事項</a>」をご参照ください。</p></div><div class="section1" id="ESRI_SECTION1_D145A38FA7744A09BEF49F7BFFFBB5ED" purpose="section1"><h2>Data</h2><p id="GUID-3667FA67-0195-4578-BEE3-5D95D4A459BB"> この場合、「<a class="xref" rel="01n1/01n10000002s000000.htm" href="01n1/01n10000002s000000.htm">単一コンピューターの高可用性配置 (アクティブ/パッシブ)</a>」に記載されたものと同じ考慮事項が適用されます。</p></div><div class="section1" id="ESRI_SECTION1_8EF751A1A0674003B0A8AEE7DD7C0FAC" purpose="section1"><h2>  リバース プロキシ サーバー</h2><p id="GUID-08D30EAA-3B15-4022-9815-F24432074696"> この構成では、サードパーティ製のロード バランサーが必要です。少なくとも、このコンポーネントはすべてのサイト間に負荷を分散します。ロード バランサーは、ラウンド ロビンや最小接続数など、負荷を分散するためのさまざまな構成を備えています。適切な負荷分散の選択は、<span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> サイトで実行している Web サービスとその使用パターンによって異なります。また、ロードバランサーは通常、さまざまなオプションを利用して障害に対処します。たとえば、ハードウェアまたはネットワークの障害のため使用不可になっているコンピューターや、利用できない特定の <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> サービスにリクエストを転送しないようにするルールをロード バランサーに適用できます。この配置状況で提案されている単一コンピューターのサイトを使用する場合、特定のコンピューターに送信されたリクエストはそのコンピューターで処理されることが保証されます。</p><p id="GUID-A0ECF165-A482-4351-963D-45E5266F6145"> 通常、ロード バランサー自体が、リバース プロキシ サーバーの役割も果たします (「<a class="xref" rel="01n1/01n10000002r000000.htm" href="01n1/01n10000002r000000.htm">リバース プロキシ サーバーを使用した単一コンピューターの配置</a>」を参照)。場合によっては、すでに<a class="xref" target="_blank" rel="http://server.arcgis.com/ja/server/latest/administer/windows/using-a-reverse-proxy-server-with-arcgis-server.htm" href="http://server.arcgis.com/ja/server/latest/administer/windows/using-a-reverse-proxy-server-with-arcgis-server.htm">リバース プロキシ サーバー</a>をロード バランサーから独立して構成している場合もあります。</p><p id="GUID-F79D5977-06ED-4481-B6B3-074FFE7C8F1C">ネットワーク ロード バランサーが状態チェック機能に対応している場合は、<span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> の状態チェック エンドポイントを使用して、サイトがリクエストを受け取れるかどうかを確認できます。これは、サイトでソフトウェアまたはハードウェアの障害があるかどうかを迅速に確認する場合に便利です。詳細については、ArcGIS REST API の「<a class="xref" target="_blank" rel="http://resources.arcgis.com/ja/help/arcgis-rest-api/02r3/02r3000002n7000000.htm" href="http://resources.arcgis.com/ja/help/arcgis-rest-api/02r3/02r3000002n7000000.htm">状態チェック</a>」をご参照ください。</p><p id="GUID-10CCD4D6-1935-4717-9D69-BFC43BE1161C"> <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> の使用はオプションであり、通常、このシナリオで Web 層認証を利用したい場合にのみ必要になります。ArcGIS Web Adaptor は、<span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> と同じコンピューターに構成することも、あるいは、専用のコンピューターに構成することもできます。いずれの場合も、<span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> を使用する場合は、サイトごとに個別の <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> を構成する必要があります。</p></div><div class="section1" id="ESRI_SECTION1_196562782F0149D9A8D7862BA38841EB" purpose="section1"><h2>その他の考慮事項</h2><div class="section2" id="ESRI_SECTION2_C0955A61BFD348F68136E7289F25B83B" purpose="section2"><h3>サイト間でのサービスの同期状態の維持</h3><p id="GUID-236BE866-44C2-4547-A913-EFAC3C3B4888"> 実際の複数コンピューターのサイトとは異なり、この構成では、ロード バランサーの内側にあるすべてのサイトがまったく同じコンテンツをホストし、同じセキュリティ モデルに従う必要があります。管理者は、ロード バランサーから見て、すべてのサイトがまったく同じになるようにする必要があります。</p><p id="GUID-8F3DE45D-6ADC-4E02-9070-DB09850AFCC8"> プライマリ サイトとフェイルオーバー サイト間で <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> サービスの同期を維持するために役立つ方法がいくつかあります。</p><ul purpose="ul" id="UL_F4A876F72DBB46A397A69054C851CD96"><li purpose="li" id="LI_2402FD84A05D4D2695366E4E4B018FF4">スクリプト: <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> は、管理タスク (サービスの公開やサービスのセキュリティ設定の変更など) のスクリプトの作成に使用できる REST ベースの管理用 API を備えています。ユーザーは独自のスクリプトを作成して、配置に関係するすべての <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> コンピューターに一貫して変更を適用することができます。スクリプトは、サービスのセキュリティの変更や上書きなど、微調整を行う必要がある場合に特に便利です。詳細については、「<a class="xref" target="_blank" rel="http://server.arcgis.com/ja/server/latest/administer/windows/scripting-arcgis-server-administration.htm" href="http://server.arcgis.com/ja/server/latest/administer/windows/scripting-arcgis-server-administration.htm">ArcGIS Server 管理のスクリプト</a>」をご参照ください。<div class="notes" id="GUID-5134A5DB-8BC5-4DF9-980C-118EA56D6B51"><div class="note"><img class="note_img" src="rsrc/note.png" alt="備考" title="注意"><span>注意:</span></div><div class="tipbody"><p id="GUID-B634C6CC-937A-49DA-8C98-CD7EAFA8A785">スクリプトを使用して初期サイトを作成しないでください。仮想コンピューター イメージに最初のサイトを手動で作成し、このベース イメージから追加のサイトを作成するスクリプトを作成します。同じ仮想コンピューター イメージからすべてのコンピューターを作成すると、すべてのコンピューターが同じ暗号化キーを使用するようになります。</p></div></div></li><li purpose="li" id="LI_952B7B2D50774CF58097DC68DC7094F5"> 仮想化: 仮想コンピューター テンプレートを作成し、それを使用して新しいサイトを立ち上げます。前述したように、これによって、すべてのコンピューターが同じ暗号化キーを使用するようになります。また、各テンプレートには、GIS サービスで必要なデータのコピー (データベースが使用されている場合を除く) と、公開および構成済みのすべてのサービスが含まれます。既存のサービスの追加や更新などの変更が必要な場合、新しいテンプレートを作成し、後続の仮想コンピューターを起動して、ロード バランサーの下で使用されている既存の <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> コンピューターのプールをこれらのコンピューターで置き換えることができます。また、仮想コンピューター テンプレートを使用して、古い <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> コンピューターを復元することもできます。</li></ul><p id="GUID-34948C59-10A8-43D3-9F4B-0BA0299F63D9"> この配置パターンで変更をサイトに適用する場合に推奨される手順は以下のとおりです。</p><div class="wfsteps" purpose="wfsteps"><h4></h4><div class="steps" id="ESRI_STEPS_784E84BE74D5437E9707B1399BAF19EE"><div class="step_title">手順:</div><ol><li purpose="step" id="ESRI_STEP_B00B728FB6064C4E9681C58120712FBB"><span purpose="cmd" id="GUID-212C7A42-1687-4CCF-8C9C-07B0C4F1FB24"> 最初にスタンバイ モードにあるサイトに対して、管理情報の変更を行います。たとえば、アクティブにリクエストを処理していないサイトで新しいサービスを追加し、別のサービスのセキュリティを変更します。これにより、プライマリ サイトを使用しているアプリケーションには何も影響がないことが保証されます。</span></li><li purpose="step" id="ESRI_STEP_4EB66725C203433EAE03FF73D698F6EA"><span purpose="cmd" id="GUID-437B3239-C47C-4C38-B0B1-FCDD44E91446">変更を行ったスタンバイ サイトにすべてのリクエストを渡すようロード バランサーを手動で構成します。</span></li><li purpose="step" id="ESRI_STEP_4D19A677A2694061AFDF1806C895BB3B"><span purpose="cmd" id="GUID-6350C413-0F06-4D6C-AE2D-8AE3C45F3423">アイドル状態のサイトに同じ変更を適用します。</span></li><li purpose="step" id="ESRI_STEP_18542AF42544419FA949DC39C30CDBD4"><span purpose="cmd" id="GUID-43995EA3-BF8D-431F-9636-94A578E0E428">リクエストが元のプライマリ サイトに送られるようにロード バランサーの構成を元に戻して、スタンバイ サイトをスタンバイ モードのままにします。</span></li></ol></div></div><p id="GUID-87CCE021-1815-4423-8A82-75FB64408A6B"> 上記の手順でサイトに対して行った変更は、<span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> Manager、スクリプト、または仮想イメージを使用して手動で適用できます。</p></div><div class="section2" id="ESRI_SECTION2_18A9D985BCFE499E9519BC5084CCB1B3" purpose="section2"><h3>出力ディレクトリの共有</h3><p id="GUID-22758F5B-AC7B-46BA-8384-6B5C7A1127E7">一部の <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> サービスの操作では、1 つ以上の出力ディレクトリ内のリソースを参照します。たとえばマップ サービスは、画像を出力ディレクトリに書き込み、それらの画像をリクエストのレスポンスで URL を介して参照する場合があります。クライアントがその画像を正常に取得するには、アクティブ/アクティブ構成内のすべてのサイトが同じ出力ディレクトリを参照する必要があります。これを実現するには、出力ディレクトリをネットワーク リソース上に配置し、それらを各サイトで共有します。</p><p id="GUID-5228E005-D886-437A-A492-AD4B96BC5DCA">出力ディレクトリを使用するサービスの操作を以下に示します。</p><ul purpose="ul" id="UL_68A5033169114B18B7A572649B709AA8"><li purpose="li" id="LI_77ED29AD1C4A4D34B1F219D776C28968"><a class="xref" target="_blank" rel="http://resources.arcgis.com/ja/help/arcgis-rest-api/02r3/02r3000000rp000000.htm" href="http://resources.arcgis.com/ja/help/arcgis-rest-api/02r3/02r3000000rp000000.htm">フィーチャ サービスのレプリカの作成</a> (フィーチャ サービス)</li><li purpose="li" id="LI_7AA237DE47F14F308CFD25D74BC00B5F"><a class="xref" target="_blank" rel="http://resources.arcgis.com/ja/help/arcgis-rest-api/02r3/02r3000000s7000000.htm" href="http://resources.arcgis.com/ja/help/arcgis-rest-api/02r3/02r3000000s7000000.htm">ラスター画像のダウンロード</a> (イメージ サービス)</li><li purpose="li" id="LI_3CC1979547874B5F8BDC59C3F9A1500D"><a class="xref" target="_blank" rel="http://resources.arcgis.com/ja/help/arcgis-rest-api/02r3/02r3000000v7000000.htm" href="http://resources.arcgis.com/ja/help/arcgis-rest-api/02r3/02r3000000v7000000.htm">マップ画像のエクスポート</a> (マップ サービス)</li><li purpose="li" id="LI_B37B3AF223C843B58948733888F8CA60"><a class="xref" target="_blank" rel="http://resources.arcgis.com/ja/help/arcgis-rest-api/02r3/02r3000000wn000000.htm" href="http://resources.arcgis.com/ja/help/arcgis-rest-api/02r3/02r3000000wn000000.htm">スケマティック ダイアグラムのエクスポート</a> (マップ サービスのスケマティック機能)</li><li purpose="li" id="LI_F558A74F704344E8B6AAEAEB35878457"><a class="xref" target="_blank" rel="http://resources.arcgis.com/ja/help/arcgis-rest-api/02r3/02r3000001m3000000.htm" href="http://resources.arcgis.com/ja/help/arcgis-rest-api/02r3/02r3000001m3000000.htm">Web マップのエクスポート</a> (ジオプロセシング サービス)</li></ul></div><div class="section2" id="ESRI_SECTION2_7DDC0166EDAF43C494BD072E72CB2F86" purpose="section2"><h3>ジオプロセシング サービスの非同期実行</h3><p id="GUID-A4ED5B7B-049F-41E7-8788-A76539A4ABF4"><span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> ジオプロセシング サービスは、同期実行モードと非同期実行モードをサポートしています。同期実行は、ステートレスなリクエスト/レスポンス パターンに従い、アクティブ/アクティブ構成で完全にサポートされています。非同期実行は、ステートフルなリクエスト/レスポンス パターンに従います (これがデフォルトです)。アクティブ/アクティブ構成で非同期実行を使用するには、以下を考慮する必要があります。</p><ul purpose="ul" id="UL_E514C178FA174602A1CA703EBFE88C60"><li purpose="li" id="LI_5A8AFCB46EDC489E843064159E5D4220"> 非同期ジオプロセシング ジョブを送信すると、送信されたジョブとその出力を参照するジョブ ID が返されます。元のリクエストを受信した <span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> サイトのみが、この ID を認識できます。そのため、アクティブ/アクティブ構成で非同期実行を使用する場合、ロード バランサーでアフィニティ (固定的なセッションとも呼ばれる) を定義する必要があります。これにより、非同期のジオプロセシング サービスおよびマップ サービスの出力に高可用性が提供されます。ロード バランサーのベンダーに問い合わせて、固定的なセッションを有効化することによる影響を把握してください。</li><li purpose="li" id="LI_24BDF1995314447EAF7A8DA98409374D"> ジオプロセシング サービスが出力をレンダリングするためにマップ サービスを使用せず、「ファイル」タイプの出力が定義されていない場合は、ジオプロセシング サービスで同期実行を選択することができます。ロード バランサーでの固定的なセッションは必要ありません。</li></ul></div><div class="section2" id="ESRI_SECTION2_AD2A918F0F5D4FF59EEDA3502C56B77A" purpose="section2"><h3>トークンベースのセキュリティの使用</h3><p id="GUID-D8F944FD-F648-4A63-84EB-013DDE5EE2F1"> トークンベースの認証 (GIS 層認証とも呼ばれる) を使用している場合、この構成内のすべてのサイトがまったく同じ共有トークン鍵を使用することが重要です。それ以外の場合、一方のコンピューター向けに生成されたトークンは、他方のコンピューターに対して使用されるときに有効になりません。複数のサイト間で共有トークン鍵を複製する方法については、「<a class="xref" target="_blank" rel="http://server.arcgis.com/ja/server/latest/administer/windows/about-arcgis-tokens.htm" href="http://server.arcgis.com/ja/server/latest/administer/windows/about-arcgis-tokens.htm">ArcGIS トークンについて</a>」と「<a class="xref" target="_blank" rel="http://server.arcgis.com/ja/server/latest/administer/windows/editing-token-settings-in-manager.htm" href="http://server.arcgis.com/ja/server/latest/administer/windows/editing-token-settings-in-manager.htm">ArcGIS Server Manager でのトークン設定の編集</a>」をご参照ください。</p></div></div><div class="section1" id="ESRI_SECTION1_7D80FDD6984A4CB89673169EC202AE9B" purpose="section1"><h2>メリット</h2><ul purpose="ul" id="UL_29B1CEDBC9B64C93B3BF5A5F2B6DDED6"><li purpose="li" id="LI_31A26F5D270D4EE3889F95C9C604163E">概念的にわかりやすい構成になっています。<span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> コンピューター間の相互依存性が最小限に抑えられているため、古くなったか、故障したコンピューターの取り替え、アップグレードの適用、<span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> のプールからのコンピューターの削除を、サービスを中断したり、リクエストを中止したりすることなく必要に応じて簡単に実施することができます。</li><li purpose="li" id="LI_720ED1C47951426CB6DBD4C224B2AA58">マップ タイルがコンピューターごとにローカルに保存されている場合、この構成を使用すると、複数コンピューターのサイトと比べてパフォーマンス上の大きなメリットが得られます。キャッシュ マップ サービスのキャパシティを増やすことがユーザーの目的である場合は、この構成が最も適しています。</li></ul></div>
<div class="section1" id="ESRI_SECTION1_41EFAD1B165B4AD7BB2360CACBFE3F46" purpose="section1"><h2>デメリット</h2><ul purpose="ul" id="UL_1AC3D6DF066C44FB855C935C830F5958"><li purpose="li" id="LI_F897D11D574943B4B765B6F5D3BA1B6A"> すべてのサイトを同期状態に維持する必要があります。これにより、管理上のオーバーヘッドが増加するため、変更頻度が高い多数のコンピューターまたはサービス/キャッシュが存在する場合にはこの配置パターンが実用的ではないことがあります。</li><li purpose="li" id="LI_0E941DCDF0974FE092B1E24E762CA34C">サードパーティ製ロード バランサーに関する知識が必要です。</li></ul></div><div class="footer"> Copyright © 1995-2017 Esri. All rights reserved. </div></div></body></html>