<html lang="ja" xml:lang="ja"><head>
<META http-equiv="Content-Type" content="text/html">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><META name="description" content="リバース プロキシ サーバーとは、境界ネットワーク (DMZ (DeMilitarized Zone) またはスクリーン サブネットとも呼ばれる) 内に配置され、インターネットからのリクエストを処理して内部ネットワーク内のコンピューターに転送するコンピューターです。"><meta name="content-language" content="ja"><link href="rsrc/htmlhelp.css" rel="stylesheet" type="text/css"><title>ArcGIS - 
Portal for ArcGIS でのリバース プロキシ サーバーの使用</title>
                <script type="text/javascript" language="JavaScript">
                    var pathL  = self.location.pathname.split ("/");
                    var fname = pathL[pathL.length-1];
                    var i = fname.lastIndexOf (".htm");
                    if (i>=0) {
                    fname = fname.substring (0, i)
                    } else {
                    //??
                    }
                    if (self.location.hash) {
				    		      fname = fname + self.location.hash;
						        }
                    self.location.replace ("../index.html#//" + fname);
                </script>
                </head><!--Publication GUID: [GUID-FB5257BE-DC53-48C6-82F8-1DA075B0A617]--><!--Topic GUID: [GUID-E452FD74-CAA7-4871-BC78-990DC4D01E03]--><body><div id="content"><div class="header"><h1>
Portal for ArcGIS でのリバース プロキシ サーバーの使用</h1><div id="breadcrumb"></div></div>
<p id="GUID-E6059846-9BAC-4204-8CA5-AA40D26CE425">リバース プロキシ サーバーとは、境界ネットワーク (DMZ (DeMilitarized Zone) またはスクリーン サブネットとも呼ばれる) 内に配置され、インターネットからのリクエストを処理して内部ネットワーク内のコンピューターに転送するコンピューターです。リバース プロキシ サーバーの代理としてリクエストの転送が実施されると、組織サイトのファイアウォールの内側にあるコンピューターのアイデンティティがマスクされるため、インターネット ユーザーによる直接的な攻撃から内部のコンピューターを保護できます。さらに進んでユーザーの内部ネットワークを外部ユーザーから保護するために、追加のセキュリティ機能をリバース プロキシ サーバーに実装できます。</p><p id="GUID-1275121D-C786-4A30-98F5-8F46E77A2F67"> リバース プロキシ サーバーが状態チェック機能に対応している場合は、<span purpose="ph" translate="no" varid="PortalForArcGIS">Portal for ArcGIS</span> の状態チェック エンド ポイントを使用して、ポータルがリクエストを受け取れるかどうかを確認できます。これは、サイトでソフトウェアまたはハードウェアの障害があるかどうかを迅速に確認する場合に便利です。詳細については、ArcGIS REST API のポータルの「<a class="xref" target="_blank" rel="http://resources.arcgis.com/ja/help/arcgis-rest-api/02r3/02r300000306000000.htm" href="http://resources.arcgis.com/ja/help/arcgis-rest-api/02r3/02r300000306000000.htm">Health Check</a>」トピックをご参照ください。</p>
<div class="notes" id="GUID-B752AE0F-289C-4AD2-829B-7A439E7D7FCD"><div class="caution"><img class="note_img" src="rsrc/caution.png" alt="注意" title="注意"><span>注意:</span></div><div class="tipbody"><p id="GUID-FB823391-E68A-4647-9728-6449BCA394C1"> このトピックで説明する構成は、<span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> サイトを <span purpose="ph" translate="no" varid="ArcGIS_Enterprise_long">ArcGIS Enterprise</span> ポータルとフェデレートする前に実行する必要があります。<span purpose="ph" translate="no" varid="ArcGISforServer">ArcGIS Server</span> サイトのフェデレーションの解除は、いくつかの大きな影響をもたらします。また、これを簡単に元に戻すことはできません。詳細については、「<a class="xref" target="_blank" rel="http://server.arcgis.com/ja/portal/latest/administer/windows/administer-a-federated-server.htm" href="http://server.arcgis.com/ja/portal/latest/administer/windows/administer-a-federated-server.htm">フェデレーション サーバーの管理</a>」をご参照ください。</p></div></div><div class="section1" id="ESRI_SECTION1_95330DD599D34B899A6AEF123440D24A" purpose="section1"><h2>リバース プロキシ サーバーへの <span purpose="ph" translate="no" varid="PortalForArcGIS">Portal for ArcGIS</span> の追加</h2><p id="GUID-57E96981-0F4F-4CCD-8575-3887DFF10792">組織のリバース プロキシ サーバーに <span purpose="ph" translate="no" varid="PortalForArcGIS">Portal for ArcGIS</span> を追加する前に、次の操作を完了する必要があります。</p><ul purpose="ul" id="UL_F5978DE6A82346F08A10E966A8728ACE"><li purpose="li" id="LI_85752451301946C7818E4E5249B90325"> リバース プロキシ サーバーに HTTPS (HTTP および HTTPS、または HTTPS のみ) を構成します。<span purpose="ph" translate="no" varid="PortalForArcGIS">Portal for ArcGIS</span> では、一部の通信に対して HTTPS が必要です。プロキシ サーバーの製品マニュアルで、HTTPS の設定方法を確認してください。</li><li purpose="li" id="LI_F8E6F46E52544930BB282767356DEF21">ポータルで<a class="xref" rel="01n1/01n100000029000000.htm" href="01n1/01n100000029000000.htm">統合 Windows 認証</a>を使用する場合、<span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> をポータルに構成します。このため、<span purpose="ph" translate="no" varid="PortalForArcGIS">Portal for ArcGIS</span> では <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> を使用する必要があります。これを使用することにより、リバース プロキシ サーバーがポータルと正常に通信できるようになります。手順の詳細については、<a class="xref" rel="01n1/01n10000001p000000.htm" href="01n1/01n10000001p000000.htm">IIS</a>、<a class="xref" target="_blank" rel="http://server.arcgis.com/ja/portal/latest/administer/windows/configure-arcgis-web-adaptor-portal.htm" href="http://server.arcgis.com/ja/portal/latest/administer/windows/configure-arcgis-web-adaptor-portal.htm">Java (Windows)</a> または <a class="xref" target="_blank" rel="http://server.arcgis.com/ja/portal/latest/administer/windows/configure-arcgis-web-adaptor-portal.htm" href="http://server.arcgis.com/ja/portal/latest/administer/windows/configure-arcgis-web-adaptor-portal.htm">Java (Linux)</a> の構成トピックをご参照ください。</li></ul><p id="GUID-37C824CC-8344-4847-B87E-A773A4917343"> <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> を <span purpose="ph" translate="no" varid="PortalForArcGIS">Portal for ArcGIS</span> で構成した後、<span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> を組織サイトのリバース プロキシ サーバーで使用するには、これらのコンポーネントをプロキシ サーバー ディレクティブに直接追加します。たとえば、リバース プロキシ サーバーとして Apache を使用している場合は、Apache Web サーバー構成ファイルの <span class="usertext">httpd.conf</span> で、ProxyPass ディレクティブに <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> を追加する必要があります。</p><div class="codeblock" purpose="codeblock"><div class="highlight"><pre><code>ProxyPass /arcgis https://webadaptorhost.domain.com/webadaptorname
ProxyPassReverse /arcgis https://webadaptorhost.domain.com/webadaptorname
</code></pre></div>
</div><p id="GUID-FE2EA9BF-35AA-4795-ADD1-53CD686B7D1C">ProxyPass ディレクティブは <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> に対して指定された名前と一致する必要があります (上の例では <span class="usertext">/webadaptorname</span>)。サイトの URL の末尾がデフォルト文字列 <span class="usertext">/arcgis</span> でない場合は、<span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> のデフォルト以外の名前を指定します (たとえば <span class="usertext">/myorg</span>)。</p><p id="GUID-9F7B9781-DE8C-4648-BA8B-71B50B1AD252">プロキシ サーバーが gzip エンコーディングをサポートしていることと、<span class="usertext">Accept-Encoding</span> ヘッダーを許可するように構成されていることを確認します。このヘッダーによって、gzip エンコーディングを使用して HTTP 1.1 の応答を圧縮できるようになります。たとえば、このヘッダーが許可されている場合、<span purpose="ph" translate="no" varid="AGMapViewer">Map Viewer</span>を読み込むリクエストは、約 1.4 MB の圧縮された応答をブラウザーに返します。このヘッダーが許可されていない場合や無視されている場合、リクエストは約 6.8 MB の圧縮されていない応答をブラウザーに返します。ネットワーク速度が遅い場合、応答が圧縮されていないと<span purpose="ph" translate="no" varid="AGMapViewer">Map Viewer</span>を読み込むのに時間がかかる可能性があります。リバース プロキシ サーバー構成の一部として、このヘッダーを許可することを強くお勧めします。</p><p id="GUID-74EBEF4A-6086-41E1-B684-E34751FB0F74">ポータルの <span class="usertext">WebContextURL</span> プロパティを設定します。これにより、<span purpose="ph" translate="no" varid="PortalForArcGIS">Portal for ArcGIS</span> はすべてのリソースで正しい URL を構築して、エンド ユーザーに送信することができます。次の手順で、<span class="usertext">WebContextURL</span> を変更します。</p><div class="wfsteps" purpose="wfsteps"><h4></h4><div class="steps" id="GUID-6E6E7C99-8AEA-46C9-8F20-020A8CFAB3DC"><div class="step_title">手順:</div><ol>
<li purpose="step" id="GUID-59FDE619-ABBD-4492-BFEE-28FF55DE3383">
<span purpose="cmd" id="GUID-9EA6CB2B-42D5-4CDB-B3F4-A6B7F812091D">Web ブラウザーを開き、ポータル組織のデフォルトの管理者ロールのメンバーとして、<a class="xref" target="_blank" rel="http://server.arcgis.com/ja/portal/latest/administer/windows/about-the-arcgis-portal-directory.htm" href="http://server.arcgis.com/ja/portal/latest/administer/windows/about-the-arcgis-portal-directory.htm">ArcGIS Portal Directory</a> にサイン インします。URL の形式は、<span class="usertext">https://portal.domain.com:7443/arcgis/portaladmin</span> です。</span>
</li>
<li purpose="step" id="ESRI_STEP_4A71032028594FDFAE77EB6051A96881"><span purpose="cmd" id="GUID-A236D912-6825-4E73-B1DB-D8C814D49586"><span class="uicontrol">[System] <span class="greaterthan">→</span> [Properties] <span class="greaterthan">→</span> [Update Properties]</span> の順にクリックします。</span></li><li purpose="step" id="ESRI_STEP_0EF7E5092BE34404ABD96EE79938D1D4"><span purpose="cmd" id="GUID-063C0CE8-7348-4DDA-BB7E-7A4032491D28"><span class="uicontrol">[Update System Properties]</span> ダイアログ ボックスに次の JSON を挿入し、ユーザーが組織のファイアウォールの外部から参照する際に使用する独自のリバース プロキシ サーバーまたは DNS エイリアス URL に置き換えてください。</span><div class="info" purpose="info"><div class="codeblock" purpose="codeblock"><div class="highlight"><pre><code>{
   &quot;WebContextURL&quot;: &quot;https://reverseproxy.domain.com/myorg&quot;
}
</code></pre></div>
</div></div></li><li purpose="step" id="ESRI_STEP_1457CC3BB07B4B71B9EC8B3D90E02C29"><span purpose="cmd" id="GUID-2D3DBC34-4358-4CC3-97A3-A368FAFB412E"><span class="uicontrol">[Update Properties]</span> をクリックします。</span></li></ol></div><div class="result" id="ESRI_RESULT_E0467B285DAC41E8A139B7CE28B5FB8D" purpose="result"><p id="GUID-8C019229-BD7E-4ABB-B2A4-BB6F6254F952">  ポータルでリバース プロキシ サーバーの構成が完了した後は、<span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> の URL の代わりに、リバース プロキシ サーバーの URL を介してポータルにアクセスします。ポータル Web サイトまたは ArcGIS Portal Directory にアクセスした場合、必ずリバース プロキシ サーバーの URL が返されます。</p><p id="GUID-D24561C2-6370-4C50-A1B0-7BC7114463E1">リバース プロキシ サーバーの URL を使用し、次の管理タスクをやり直す必要があります。</p><ul purpose="ul" id="UL_41CD7E1BB59F467797051D32633B1739"><li purpose="li" id="LI_3CDA933062E64F718442AF43005DBC63"><a class="xref" target="_blank" rel="http://server.arcgis.com/ja/portal/latest/administer/windows/federate-an-arcgis-server-site-with-your-portal.htm" href="http://server.arcgis.com/ja/portal/latest/administer/windows/federate-an-arcgis-server-site-with-your-portal.htm">ArcGIS Server サイトとポータルのフェデレーション</a></li><li purpose="li" id="LI_F3E155D55DBD47D1B5F99B32FC125622"><a class="xref" target="_blank" rel="http://server.arcgis.com/ja/portal/latest/administer/windows/configure-services.htm" href="http://server.arcgis.com/ja/portal/latest/administer/windows/configure-services.htm">ユーティリティ サービスの構成</a></li></ul><p id="GUID-59AEAE25-42E1-41C5-9348-2710B487DCC2">以前に、セキュリティで保護されたサービスをアイテムとしてポータルに追加している場合、元のアイテムを削除して、それらを再び追加する必要があります。これは、元のアイテムが、リバース プロキシ サーバーの URL ではなく <span purpose="ph" translate="no" varid="WebAdaptorforArcGIS">ArcGIS Web Adaptor</span> の URL を使用しているためです。手順については、「<a class="xref" target="_blank" rel="http://server.arcgis.com/ja/portal/latest/administer/windows/connect-secured-services.htm" href="http://server.arcgis.com/ja/portal/latest/administer/windows/connect-secured-services.htm">セキュリティで保護されたサービスへの接続</a>」をご参照ください。</p></div></div></div><div class="footer"> Copyright © 1995-2017 Esri. All rights reserved. </div></div></body></html>